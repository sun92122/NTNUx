import H from"./C-i_I8p_.js";import P from"./kmSW8NJw.js";import Q from"./DGmOhxyE.js";import{_ as W,r as _,t as y,v as h,x as a,z as u,H as M,I as U,y as c,B as b,J as s,K as J,L as x,M as S,A as i,N as E,o as K,O as z,P as p,Q as X}from"./s1722x7W.js";import Y from"./B_F0s8d9.js";import Z from"./yUwRGsPc.js";import ee from"./Cn7Xc40O.js";import le from"./D82olNW8.js";import"./DRQ47Bra.js";import te from"./DkuA2G40.js";import ae from"./WQeDHh1N.js";import oe from"./CwQki2wt.js";import se from"./CYhTV6Lt.js";import re from"./B7XKarvl.js";import"./D3UmIg8N.js";import ne from"./CGO4bxS6.js";import N from"./B6cHNt5g.js";import"./BSRKd42o.js";import"./BR-ygiXy.js";import"./ptecmK9q.js";import"./CtGL8pzc.js";import"./FD62OdHi.js";import"./CE_pJACd.js";import"./Cbns0I4H.js";import"./BeEVsaxZ.js";import"./D2gadjwC.js";import"./Brw3qxgM.js";import"./BQCXkhAk.js";import"./DvkStdr4.js";import"./D7iFx4D4.js";import"./S9j7AFgT.js";import"./aSsRHcYg.js";import"./CxoEUkKL.js";import"./NNNRNFhq.js";import"./COy73f39.js";import"./CRkCa4ch.js";import"./Bnb-2yWw.js";import"./BT7mR474.js";import"./CcT1yRY0.js";import"./mOTnLC0E.js";import"./BKUKSrNd.js";import"./B1FEAGDy.js";import"./DH6ObA2R.js";import"./OQ4BVOfZ.js";const ie={class:"schedule-box"},ue={class:"timetable"},ce={class:"row header-row"},de={class:"cell time-cell"},me={__name:"floatingSchedule",props:{selectedRows:{type:Array,default:()=>[]}},setup(t){const D=t,C=["一","二","三","四","五"],G=[{label:"0",time:"07:10 ~ 08:00"},{label:"1",time:"08:10 ~ 09:00"},{label:"2",time:"09:10 ~ 10:00"},{label:"3",time:"10:20 ~ 11:10"},{label:"4",time:"11:20 ~ 12:10"},{label:"5",time:"12:20 ~ 13:10"},{label:"6",time:"13:20 ~ 14:10"},{label:"7",time:"14:20 ~ 15:10"},{label:"8",time:"15:30 ~ 16:20"},{label:"9",time:"16:30 ~ 17:20"},{label:"10",time:"17:30 ~ 18:20"},{label:"A",time:"18:30 ~ 19:25"},{label:"B",time:"19:35 ~ 20:25"},{label:"C",time:"20:30 ~ 21:20"},{label:"D",time:"21:25 ~ 22:15"}];function k(n){const r=[];if(typeof n!="object"||!n)return r;for(const o of Object.keys(n)){const d=o.match(/([一二三四五])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(d){const[A,$,F,R]=d,V=m(F,R||F);for(const j of V)r.push({day:$,period:j,loc:n[o]})}}return r}function m(n,r){const o=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],d=o.indexOf(n),A=o.indexOf(r);return o.slice(d,A+1)}const g=_({});function L(){g.value={};for(const n of D.selectedRows){const r=k(n.time_loc||"");for(const o of r)g.value[o.day]||(g.value[o.day]={}),g.value[o.day][o.period]||(g.value[o.day][o.period]=[]),g.value[o.day][o.period].push({...n,loc:o.loc})}}L();const T=_({});function O(n){const r=["#FFDD57","#87CEEB","#FF7F7F","#90EE90","#DDA0DD","#FFA07A","#00CED1","#F4A460","#B0E0E6","#FFB6C1"],o=Array.from(n).reduce((d,A)=>d+A.charCodeAt(0),0);return r[o%r.length]}function B(n){return n in T.value||(T.value[n]=O(n)),T.value[n]}_(null);const w=_([{label:"顏色",icon:"pi pi-palette",command:n=>{}}]);return(n,r)=>(h(),y(M,null,[a("div",ie,[a("div",ue,[a("div",ce,[r[0]||(r[0]=a("div",{class:"cell time-cell"},null,-1)),(h(),y(M,null,U(C,o=>a("div",{key:o,class:"cell"},c(o),1)),64))]),(h(),y(M,null,U(G,o=>a("div",{key:o.label,class:"row"},[a("div",de,[b(c(o.label),1),r[1]||(r[1]=a("br",null,null,-1)),a("small",null,c(o.time),1)]),(h(),y(M,null,U(C,d=>{var A;return a("div",{key:d,class:"cell"},[(h(!0),y(M,null,U(((A=s(g)[d])==null?void 0:A[o.label])||[],$=>(h(),y("div",{key:$.serial_no,class:"course-block",style:J({backgroundColor:B($.serial_no)})},[b(c($.chn_name.replace(/<\/?br>/g," "))+" ",1),r[2]||(r[2]=a("br",null,null,-1)),b(" "+c($.teacher)+" ",1),r[3]||(r[3]=a("br",null,null,-1)),b(" "+c($.loc),1)],4))),128))])}),64))])),64))])]),u(s(ne),{model:s(w),direction:"up",style:{position:"absolute",right:"-2.5rem",bottom:"1.5rem"},buttonProps:{severity:"secondary",rounded:!0},tooltipOptions:{position:"left"}},null,8,["model"])],64))}},ve=W(me,[["__scopeId","data-v-6fb71c29"]]),fe={class:"course-row"},pe={class:"course-cell course-code"},he={class:"course-cell course-title"},be={class:"course-name"},ge=["href"],ye={class:"message-group"},_e={class:"course-cell"},Ce={class:"message-group"},Ae={class:"course-cell course-comment"},$e={key:0},Ne={key:1},we={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(t){const D={必:"必修",選:"選修",通:"通識"},C={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(G,k)=>(h(),y("div",fe,[a("div",pe,[a("span",null,c(t.course.serial_no),1),a("span",null,c(t.course.course_code),1)]),a("div",he,[a("span",be,[a("a",{href:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${t.course.acadm_year}&term=${t.course.acadm_term}&courseCode=${t.course.course_code}&courseGroup=${t.course.course_group}&deptCode=${t.course.dept_code}&formS=${t.course.form_s}&classes1=${t.course.classes}&deptGroup=${t.course.dept_group_name}`,target:"_blank"},c(t.course.course_name),9,ge)]),a("div",ye,[u(s(N),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(t.course.dept_chiabbr),1)]),_:1}),u(s(N),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(t.course.teacher),1)]),_:1}),t.course.time?(h(),x(s(N),{key:0,icon:"pi pi-clock",severity:t.course.time.match(/.* 1[-/$]/)?"warn":"secondary",class:"custom-message"},{default:i(()=>[b(c(t.course.time),1)]),_:1},8,["severity"])):S("",!0),t.course.location?(h(),x(s(N),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(t.course.location),1)]),_:1})):S("",!0)])]),a("div",_e,[a("div",Ce,[u(s(N),{icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(D[t.course.option_code]||t.course.option_code),1)]),_:1}),t.course.generalCore?(h(!0),y(M,{key:0},U(t.course.generalCore.split("/"),m=>(h(),x(s(N),{key:m,icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(C[m]||m),1)]),_:2},1024))),128)):S("",!0),u(s(N),{icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(Math.floor(t.course.credit))+" 學分",1)]),_:1}),u(s(N),{icon:"pi pi-users",severity:"secondary",class:"custom-message"},{default:i(()=>[b(c(`${t.course.limit_count_h} 人`),1)]),_:1}),t.course.eng_teach==="是"?(h(),x(s(N),{key:1,severity:"error",class:"custom-message"},{default:i(()=>k[0]||(k[0]=[b("英文授課")])),_:1})):S("",!0)])]),a("div",Ae,[t.course.restrict?(h(),y("span",$e,c(t.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):S("",!0),t.course.comment?(h(),y("span",Ne,c(t.course.comment.replace(/<\/br>/g,`
`)),1)):S("",!0)])]))}},Me={class:"tabs-container"},ke={class:"container"},Oe={class:"search-container search-bar"},Se={key:0,class:"search-input multi-search-input-sub-filter"},De={class:"grid-container"},Cl={__name:"index",setup(t){const D=E("terms",()=>[]),C=E("currentTerm",()=>null),G=E("loadTermData"),k=E("updateMenubar");K(async()=>{const e=await(await fetch("data/terms.json")).json();D.value=e.terms,C.value=D.value[e.defaultIndex],k.value(),G.value=j,G.value()});const m=_({value:null,filter_field:null,select_list:[],label:null}),g=_({global:{value:null,matchMode:p.CONTAINS},option_code:{value:null,matchMode:p.EQUALS},course_name:{value:null,matchMode:p.CONTAINS},chn_name:{value:null,matchMode:p.CONTAINS},dept_chiabbr:{value:null,matchMode:p.CONTAINS},eng_teach:{value:null,matchMode:p.EQUALS},generalCore:{operator:z.OR,constraints:[]},dept_code:{operator:z.OR,constraints:[]}}),L=["course_name","teacher","serial_no"],T=_(!1),O=_(!0),B=_({}),w=_([]),n=_([]),r=_("quick"),o=[{label:"快速搜尋",value:"quick",command:()=>{d({})}},{label:"通識",value:"general",command:()=>{d({option_code:"通"},{label:"選擇通識領域",select_list:[{label:"人文藝術",value:{value:"A1UG",matchMode:p.CONTAINS}},{label:"社會科學",value:{value:"A2UG",matchMode:p.CONTAINS}},{label:"自然科學",value:{value:"A3UG",matchMode:p.CONTAINS}},{label:"邏輯運算",value:{value:"A4UG",matchMode:p.CONTAINS}},{label:"學院共同課程",value:{value:"B1UG",matchMode:p.CONTAINS}},{label:"跨域專業探索課程",value:{value:"B2UG",matchMode:p.CONTAINS}},{label:"大學入門",value:{value:"B3UG",matchMode:p.CONTAINS}},{label:"專題探究",value:{value:"C1UG",matchMode:p.CONTAINS}},{label:"MOOCs",value:{value:"C2UG",matchMode:p.CONTAINS}}],filter_field:"generalCore"})},filter_field:["course_name"]},{label:"體育",activeLabel:"普通體育",value:"physical",command:()=>{d({dept_chiabbr:"普通體育"})}},{label:"國防",activeLabel:"全民國防教育",value:"Defense",command:()=>{d({chn_name:"全民國防"})}},{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",command:()=>{d({dept_chiabbr:"校際"},{label:"選擇開課學校",select_list:[{label:"國立臺灣大學",value:{value:"AA",matchMode:p.ENDS_WITH}},{label:"國立臺灣科技大學",value:{value:"AB",matchMode:p.ENDS_WITH}}],filter_field:"dept_code"})}},{label:"學分學程",value:"program",command:()=>{d({chn_name:"學分學程"})}},{label:"英文三",value:"english",command:()=>{d({course_name:"英文（三）"})}},{label:"英文授課",value:"EMI",command:()=>{d({eng_teach:"是"})}},{label:"",value:"quick",command:()=>{d({})}}];function d(v,e=null){const l=g.value;for(const f in l)f!=="global"&&(f in v?l[f].value=v[f]:(l[f].value&&(l[f].value=null),l[f].constraints&&(l[f].constraints=[])));e?(m.value.value=null,m.value.filter_field=e.filter_field,m.value.select_list=e.select_list,m.value.label=e.label):m.value.filter_field=null}async function A(v){const e=await fetch(`data/${C.value}/${v}.min.json`);if(!e.ok)return null;const l=await e.json();return l.length===0?null:l.map(f=>({...f,course_name:f.chn_name.replace(/<\/br>.*/g,""),time:R(f.time_loc),location:V(f.time_loc),teacher:F(f.teacher),generalCore:f.generalCore.join("/")}))}async function $(){const v=[];for(let e=0;e<10;e++)v.push(A(e));for await(const e of v)e&&(w.value=w.value.concat(e),O.value=!1)}function F(v){return v.replace("","温")}function R(v){if(typeof v=="string")return v;const e=[];for(const[l,f]of Object.entries(v)){const[I,q]=l.split(" ");e.push(`${I} ${q}`)}return e.join("/")}function V(v){if(typeof v=="string")return null;const e=[];for(const[f,I]of Object.entries(v))I!==""&&e.push(I);const l=[...new Set(e)];return l.length===1?l[0]:e.join("/")}async function j(){if(O.value=!0,B.value[C.value]){w.value=B.value[C.value],O.value=!1;return}w.value=[],n.value=[],await $().then(()=>{O.value=!1}),B.value[C.value]=w.value,k.value()}return(v,e)=>(h(),y(M,null,[a("div",Me,[u(s(Z),{value:r.value,"onUpdate:value":e[0]||(e[0]=l=>r.value=l),scrollable:""},{default:i(()=>[u(s(le),null,{default:i(()=>[(h(),y(M,null,U(o,l=>u(s(ee),{key:l.value,value:l.value,onClick:f=>l.command?l.command():null},{default:i(()=>[b(c(r.value==l.value&&l.activeLabel||l.label),1)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1},8,["value"])]),a("div",ke,[a("div",Oe,[u(s(te),{variant:"in",class:X(["search-input",m.value.filter_field?"multi-search-input-main-filter":"single-search-input"])},{default:i(()=>[u(s(ae),null,{default:i(()=>[u(s(oe),null,{default:i(()=>e[5]||(e[5]=[a("i",{class:"pi pi-search"},null,-1)])),_:1}),u(s(se),{id:"globalFilter",modelValue:g.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value.global.value=l),autocapitalize:!1,size:"large",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e[6]||(e[6]=a("label",{for:"globalFilter"},"課程名稱/教師/開課序號",-1))]),_:1},8,["class"]),m.value.filter_field?(h(),y("div",Se,[u(s(re),{id:"sub-filter",modelValue:m.value.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.value=l),options:m.value.select_list,optionLabel:"label",optionValue:"value",style:{width:"100%"},showClear:!0,showToggleAll:!1,showFilter:!0,placeholder:m.value.label,display:"chip",onChange:e[3]||(e[3]=l=>{g.value[m.value.filter_field].constraints=l.value||[{value:null,matchMode:s(p).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):S("",!0)]),a("div",De,[u(s(H),{value:w.value,paginator:!0,filters:g.value,"global-filter-fields":r.value.filter_field||L,showGridlines:!0,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 20rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:O.value},{header:i(()=>e[7]||(e[7]=[a("span",null,"課程資訊",-1)])),loading:i(()=>[u(s(Q),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:i(()=>e[8]||(e[8]=[a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-2"}),a("span",null,"沒有符合條件的課程")],-1)])),default:i(()=>[u(s(P),{sortable:!1},{body:i(({data:l})=>[u(s(we),{course:l},null,8,["course"])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])]),u(s(Y),{visible:T.value,"onUpdate:visible":e[4]||(e[4]=l=>T.value=l),maximizable:"",modal:"",header:"Header",style:{width:"50rem",height:"80vh"},"content-style":{margin:"0 0 1rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:i(()=>[u(s(ve),{selectedRows:n.value},null,8,["selectedRows"])]),_:1},8,["visible"])],64))}};export{Cl as default};
