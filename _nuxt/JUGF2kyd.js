import{t as _,v as m,x as r,y as i,z as c,H as O,I as y,A as o,B as f,J as s,K as x,L as V,u as X,M as Y,N as A,O as Z,r as M,o as ee,P as q,Q as n,R as le,S as B,T as ae,U as te,V as se,W as R,X as oe,Y as re}from"./BhNjWe3c.js";import ue from"./Sn7MuoOD.js";import ne from"./C9pRHEVO.js";import ce from"./Bs14Cm9U.js";import ie from"./C-C4j_ZD.js";import de from"./CIIkixbR.js";import me from"./DUiI67aC.js";import b from"./B_DOFOY9.js";import"./DBXO97sU.js";import"./DHgbgvrj.js";const ve={class:"course-row"},fe={class:"course-cell course-code"},he={class:"course-cell course-title"},pe={class:"course-name"},be=["href"],ge={class:"message-group"},ye={class:"course-cell"},_e={class:"message-group"},Ce={class:"course-cell course-comment"},$e={key:0},Ne={key:1},Ae={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(t){const U={必:"必修",選:"選修",通:"通識"},g={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(k,v)=>(m(),_("div",ve,[r("div",fe,[r("span",null,i(t.course.serial_no),1),r("span",null,i(t.course.course_code),1)]),r("div",he,[r("span",pe,[r("a",{href:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${t.course.acadm_year}&term=${t.course.acadm_term}&courseCode=${t.course.course_code}&courseGroup=${t.course.course_group}&deptCode=${t.course.dept_code}&formS=${t.course.form_s}&classes1=${t.course.classes}&deptGroup=${t.course.dept_group_name}`,target:"_blank"},i(t.course.course_name),9,be)]),r("div",ge,[c(s(b),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(t.course.dept_chiabbr),1)]),_:1}),c(s(b),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(t.course.teacher),1)]),_:1}),t.course.time?(m(),O(s(b),{key:0,icon:"pi pi-clock",severity:t.course.time.match(/.* 1[-/$]/)?"warn":"secondary",class:"custom-message"},{default:o(()=>[f(i(t.course.time),1)]),_:1},8,["severity"])):y("",!0),t.course.location?(m(),O(s(b),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(t.course.location),1)]),_:1})):y("",!0)])]),r("div",ye,[r("div",_e,[c(s(b),{icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(U[t.course.option_code]||t.course.option_code),1)]),_:1}),t.course.generalCore?(m(!0),_(x,{key:0},V(t.course.generalCore.split("/"),C=>(m(),O(s(b),{key:C,icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(g[C]||C),1)]),_:2},1024))),128)):y("",!0),c(s(b),{icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(Math.floor(t.course.credit))+" 學分",1)]),_:1}),c(s(b),{icon:"pi pi-users",severity:"secondary",class:"custom-message"},{default:o(()=>[f(i(`${t.course.limit_count_h} 人`),1)]),_:1}),t.course.eng_teach==="是"?(m(),O(s(b),{key:1,severity:"error",class:"custom-message"},{default:o(()=>v[0]||(v[0]=[f("英文授課")])),_:1})):y("",!0)])]),r("div",Ce,[t.course.restrict?(m(),_("span",$e,i(t.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):y("",!0),t.course.comment?(m(),_("span",Ne,i(t.course.comment.replace(/<\/br>/g,`
`)),1)):y("",!0)])]))}},Me={class:"tabs-container"},we={class:"container"},Oe={class:"search-container search-bar"},ke={key:0,class:"search-input multi-search-input-sub-filter"},Se={class:"grid-container"},Te=null,De={__name:"index",setup(t){const U=X(),g=Y(),k=A("terms",()=>[]),v=A("currentTerm",()=>null),C=A("loadTermData"),L=A("updateMenubar"),j=Z(),h=M(""),G=M({quick:{label:"快速搜尋",value:"quick",command:()=>{p({})}},general:{label:"通識",value:"general",command:()=>{p({option_code:"通"},{label:"選擇通識領域",select_list:[{label:"人文藝術",value:{value:"A1UG",matchMode:n.CONTAINS}},{label:"社會科學",value:{value:"A2UG",matchMode:n.CONTAINS}},{label:"自然科學",value:{value:"A3UG",matchMode:n.CONTAINS}},{label:"邏輯運算",value:{value:"A4UG",matchMode:n.CONTAINS}},{label:"學院共同課程",value:{value:"B1UG",matchMode:n.CONTAINS}},{label:"跨域專業探索課程",value:{value:"B2UG",matchMode:n.CONTAINS}},{label:"大學入門",value:{value:"B3UG",matchMode:n.CONTAINS}},{label:"專題探究",value:{value:"C1UG",matchMode:n.CONTAINS}},{label:"MOOCs",value:{value:"C2UG",matchMode:n.CONTAINS}}],filter_field:"generalCore"})},filter_field:["course_name"]},physical:{label:"體育",activeLabel:"普通體育",value:"physical",command:()=>{p({dept_chiabbr:"普通體育"})}},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",command:()=>{p({chn_name:"全民國防"})}},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",command:()=>{p({dept_chiabbr:"校際"},{label:"選擇開課學校",select_list:[{label:"國立臺灣大學",value:{value:"AA",matchMode:n.ENDS_WITH}},{label:"國立臺灣科技大學",value:{value:"AB",matchMode:n.ENDS_WITH}}],filter_field:"dept_code"})}},program:{label:"學分學程",value:"program",command:()=>{p({chn_name:"學分學程"})}},english:{label:"英文三",value:"english",command:()=>{p({course_name:"英文（三）"})}},emi:{label:"英文授課",value:"emi",command:()=>{p({eng_teach:"是"})}},"":{label:"",value:"quick",command:()=>{p({})}}});ee(async()=>{var l;const e=await(await fetch("data/terms.json")).json();k.value=e.terms,v.value=g.query.term,(!v.value||k.value.indexOf(v.value)===-1)&&(v.value=k.value[e.defaultIndex]),L.value(),h.value=g.query.m.toLowerCase()||"quick",C.value=Q,C.value(),G.value[h.value]?(l=G.value[h.value])==null||l.command():h.value="quick"});const d=M({value:null,filter_field:null,select_list:[],label:null}),$=M({global:{value:Te,matchMode:n.CONTAINS},option_code:{value:null,matchMode:n.EQUALS},course_name:{value:null,matchMode:n.CONTAINS},chn_name:{value:null,matchMode:n.CONTAINS},dept_chiabbr:{value:null,matchMode:n.CONTAINS},eng_teach:{value:null,matchMode:n.EQUALS},generalCore:{operator:q.OR,constraints:[]},dept_code:{operator:q.OR,constraints:[]}}),D=["course_name","teacher","serial_no"],w=M(!0),I=A("rowDatas",()=>({})),N=M([]),S=A("selectedRows",()=>({}));function p(a,e=null){const l=$.value;for(const u in l)u!=="global"&&(u in a?l[u].value=a[u]:(l[u].value&&(l[u].value=null),l[u].constraints&&(l[u].constraints=[])));e?(d.value.value=null,d.value.filter_field=e.filter_field,d.value.select_list=e.select_list,d.value.label=e.label):d.value.filter_field=null}async function F(a){const e=await fetch(`data/${v.value}/${a}.min.json`);if(!e.ok)return null;const l=await e.json();return l.length===0?null:l.map(u=>({...u,course_name:u.chn_name.replace(/<\/br>.*/g,""),time:H(u.time_loc),location:P(u.time_loc),teacher:z(u.teacher),generalCore:u.generalCore.join("/")}))}async function E(){const a=[];for(let e=0;e<10;e++)a.push(F(e));for await(const e of a)e&&(N.value=N.value.concat(e),w.value=!1)}function z(a){return a.replace("","温")}function H(a){if(typeof a=="string")return a;const e=[];for(const[l,u]of Object.entries(a)){const[T,K]=l.split(" ");e.push(`${T} ${K}`)}return e.join("/")}function P(a){if(typeof a=="string")return null;const e=[];for(const[u,T]of Object.entries(a))T!==""&&e.push(T);const l=[...new Set(e)];return l.length===1?l[0]:e.join("/")}async function Q(){if(w.value=!0,I.value[v.value]){N.value=I.value[v.value],w.value=!1;return}N.value=[],S.value={},await E().then(()=>{w.value=!1}),I.value[v.value]=N.value,L.value()}function W(a){const e=S.value;e[a.serial_no]?(delete e[a.serial_no],j.add({severity:"info",summary:"已取消選課",detail:`${a.serial_no} ${a.course_name}`,life:3e3})):(e[a.serial_no]=a,j.add({severity:"success",summary:"已選課",detail:`${a.serial_no} ${a.course_name}`,life:3e3}))}async function J(a,e=null){U.replace({path:g.path,query:{...g.query,m:a,s:e||g.query.s||null}})}return le(()=>h.value,a=>{J(a,$.value.global.value)}),(a,e)=>(m(),_(x,null,[r("div",Me,[c(s(ne),{value:h.value,"onUpdate:value":e[0]||(e[0]=l=>h.value=l),scrollable:""},{default:o(()=>[c(s(ie),null,{default:o(()=>[(m(!0),_(x,null,V(Object.values(G.value),l=>(m(),O(s(ce),{key:l.value,value:l.value,onClick:u=>l.command?l.command():null,class:B(l.label?"":"tab-disabled")},{default:o(()=>[f(i(h.value==l.value&&l.activeLabel||l.label),1)]),_:2},1032,["value","onClick","class"]))),128))]),_:1})]),_:1},8,["value"])]),r("div",we,[r("div",Oe,[c(s(de),{variant:"in",class:B(["search-input",d.value.filter_field?"multi-search-input-main-filter":"single-search-input"])},{default:o(()=>[c(s(ae),null,{default:o(()=>[c(s(te),null,{default:o(()=>e[4]||(e[4]=[r("i",{class:"pi pi-search"},null,-1)])),_:1}),c(s(se),{id:"globalFilter",modelValue:$.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>$.value.global.value=l),autocapitalize:!1,size:"large",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e[5]||(e[5]=r("label",{for:"globalFilter"},"課程名稱/教師/開課序號",-1))]),_:1},8,["class"]),d.value.filter_field?(m(),_("div",ke,[c(s(me),{id:"sub-filter",modelValue:d.value.value,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.value=l),options:d.value.select_list,optionLabel:"label",optionValue:"value",style:{width:"100%"},showClear:!0,showToggleAll:!1,showFilter:!0,placeholder:d.value.label,display:"chip",onChange:e[3]||(e[3]=l=>{$.value[d.value.filter_field].constraints=l.value||[{value:null,matchMode:s(n).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):y("",!0)]),r("div",Se,[c(s(re),{value:N.value,paginator:!0,filters:$.value,"global-filter-fields":h.value.filter_field||D,showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 20rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:w.value,style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"}},{header:o(()=>e[6]||(e[6]=[r("span",null,"課程資訊",-1)])),loading:o(()=>[c(s(ue),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:o(()=>e[7]||(e[7]=[r("div",{class:"flex align-items-center justify-content-center"},[r("i",{class:"pi pi-exclamation-triangle mr-2"}),r("span",null,"沒有符合條件的課程")],-1)])),default:o(()=>[c(s(R),{sortable:!1},{body:o(({data:l})=>[c(s(Ae),{course:l},null,8,["course"])]),_:1}),c(s(R),{headerStyle:{width:"5rem",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"5rem",textAlign:"center",paddingRight:"1rem"},header:""},{body:o(({data:l})=>[c(s(oe),{label:s(S)[l.serial_no]?"取消":"加入",severity:s(S)[l.serial_no]?"warn":"secondary",onClick:u=>W(l)},null,8,["label","severity","onClick"])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])])],64))}};export{De as default};
