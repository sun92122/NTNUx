import{D as u}from"./Dt7xPlWn.js";function L(){const a=u("terms",()=>[]),t=u("currentTerm",()=>null),n=u("loadTermData"),s=u("rowDatas",()=>({})),c=u("rowData",()=>[]),i=u("tempDatas",()=>({})),l=u("loading",()=>!0),f=u("programSet",()=>new Set),m=["course_name","teacher","serial_no"],p=async r=>{const e=await fetch(`data/${t.value}/${r}.min.json`);if(!e.ok)return null;const o=await e.json();return o.length===0?null:h(o)},j=async()=>{var e;const r=[];for(let o=0;o<10;o++)(e=i.value[t.value])!=null&&e[o]?r.push(Promise.resolve(h(i.value[t.value][o]))):r.push(p(o));for await(const o of r)o&&(c.value=c.value.concat(o),l.value=!1)},v=async()=>{if(l.value=!0,s.value[t.value]){c.value=s.value[t.value],l.value=!1;return}c.value=[],await j(),s.value[t.value]=c.value},C=async r=>{if(a.value.length>0){l.value=!1;return}const o=await(await fetch("/data/terms.json")).json();a.value=o.terms,t.value=r==null?void 0:r.query.term,(!t.value||a.value.indexOf(t.value)===-1)&&(t.value=o.defaultValue),n.value=v,await v()},S=r=>{const e=_(r.time_loc);return{...r,credit:Math.round(r.credit*10)/10,course_name:r.chn_name.replace(/<\/br>.*/g,""),time:g(r.time_loc),location:D(r.time_loc),timeLocList:e,teacher:d(r.teacher),generalCore:r.generalCore.join("/"),timeListStr:w(e),programs:y(r.chn_name)}},h=r=>(r.forEach(e=>{e.credit=Math.round(e.credit*10)/10,e.course_name=e.chn_name.replace(/<\/br>.*/g,""),e.time=g(e.time_loc),e.location=D(e.time_loc),e.timeLocList=_(e.time_loc),e.teacher=d(e.teacher),e.generalCore=e.generalCore.join("/"),e.timeListStr=w(e.timeLocList),e.programs=y(e.chn_name),e.programs&&e.programs.split("/").forEach(o=>{f.value.add(o)})}),r);return{terms:a,currentTerm:t,rowData:c,tempDatas:i,loading:l,programSet:f,reloadCurrentTerm:v,defaultGlobalFilterFields:m,initTermData:C,courseFormatter:S}}function d(a){return a.replace("","温")}function g(a){return typeof a=="string"?a:Object.entries(a).map(([t,n])=>t).join("/")}function D(a){if(typeof a=="string")return null;const t=Object.values(a).filter(s=>s!==""),n=[...new Set(t)];return n.length===1?n[0]:t.join("/")}function _(a){const t=[];if(typeof a!="object"||!a)return t;for(const n of Object.keys(a)){const s=n.match(/([一二三四五六])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(s){const[c,i,l,f]=s,m=T(l,f||l);for(const p of m)t.push({day:i,period:p,loc:a[n]})}}return t}function T(a,t){const n=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],s=n.indexOf(a),c=n.indexOf(t);return n.slice(s,c+1)}function w(a){return!Array.isArray(a)||a.length===0?"◎":a.map(({day:t,period:n})=>`${t}${n.replace("10","X")}`).join("/")}function y(a){const t=a.match(/.*\[ 學分學程：(.+?) \].*/);if(!t)return"";const n=t[1].split(" ");return n.length>0?n.join("/"):""}export{L as u};
