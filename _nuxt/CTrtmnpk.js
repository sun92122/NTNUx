import{D as c,a_ as b}from"./DiLWiPl0.js";function F(){const t=c("terms",()=>[]),a=c("currentTerm",()=>null),r=c("loadTermData"),o=c("rowDatas",()=>({})),u=c("rowData",()=>[]),m=c("tempDatas",()=>({})),f=c("loading",()=>!0),v=c("programSet",()=>new Set),p=["course_name","teacher","serial_no"],h=async s=>{const n=await fetch(`data/${a.value}/${s}.min.json`);if(!n.ok)return null;const i=await n.json();return i.length===0?null:g(i)},e=async()=>{var n;const s=[];for(let i=0;i<10;i++)(n=m.value[a.value])!=null&&n[i]?s.push(Promise.resolve(g(m.value[a.value][i]))):s.push(h(i));for await(const i of s)i&&(u.value=u.value.concat(i),f.value=!1)},l=async()=>{if(f.value=!0,o.value[a.value]){u.value=o.value[a.value],f.value=!1;return}u.value=[],await e(),o.value[a.value]=u.value},d=async s=>{if(t.value.length>0){f.value=!1;return}const i=await(await fetch("/data/terms.json")).json();t.value=i.terms,a.value=s==null?void 0:s.query.term,(!a.value||t.value.indexOf(a.value)===-1)&&(a.value=i.defaultValue),r.value=l,await l()},S=s=>{const n=$(s.time_loc);return{...s,credit:Math.round(s.credit*10)/10,course_name:s.chn_name.replace(/<\/br>.*/g,""),time:y(s.time_loc),location:w(s.time_loc),timeLocList:n,teacher:_(s.teacher),generalCore:s.generalCore.join("/"),timeListStr:C(n),programs:D(s.chn_name)}},g=s=>(s.forEach(n=>{n.credit=Math.round(n.credit*10)/10,n.course_name=n.chn_name.replace(/<\/br>.*/g,""),n.time=y(n.time_loc),n.location=w(n.time_loc),n.timeLocList=$(n.time_loc),n.teacher=_(n.teacher),n.generalCore=n.generalCore.join("/"),n.timeListStr=C(n.timeLocList),n.programs=D(n.chn_name),n.programs&&n.programs.split("/").forEach(i=>{v.value.add(i)})}),s);return{terms:t,currentTerm:a,rowData:u,tempDatas:m,loading:f,programSet:v,reloadCurrentTerm:l,defaultGlobalFilterFields:p,initTermData:d,courseFormatter:S}}function _(t){return t.replace("","温")}function y(t){return typeof t=="string"?t:Object.entries(t).map(([a,r])=>a).join("/")}function w(t){if(typeof t=="string")return null;const a=Object.values(t).filter(o=>o!==""),r=[...new Set(a)];return r.length===1?r[0]:a.join("/")}function $(t){const a=[];if(typeof t!="object"||!t)return a;for(const r of Object.keys(t)){const o=r.match(/([一二三四五六])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(o){const[u,m,f,v]=o,p=j(f,v||f);for(const h of p)a.push({day:m,period:h,loc:t[r]})}}return a}function j(t,a){const r=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],o=r.indexOf(t),u=r.indexOf(a);return r.slice(o,u+1)}function C(t){return!Array.isArray(t)||t.length===0?"◎":t.map(({day:a,period:r})=>`${a}${r.replace("10","X")}`).join("/")}function D(t){const a=t.match(/.*\[ 學分學程：(.+?) \].*/);if(!a)return"";const r=a[1].split(" ");return r.length>0?r.join("/"):""}function L(){const t=c("selectedCourses",()=>({})),a=c("selectedRows",()=>({})),r=c("selectCode",()=>new Set),o=b(),u=c("windowWidth",()=>window.innerWidth);function m(e){const l=a.value;l[e.serial_no]?(delete l[e.serial_no],o.add({severity:"info",summary:"已取消選課",detail:`${e.serial_no} ${e.course_name}`,life:3e3,group:u.value<768?"bottom":null})):(l[e.serial_no]=e,o.add({severity:"success",summary:"已選課",detail:`${e.serial_no} ${e.course_name}`,life:3e3,group:u.value<768?"bottom":null}))}function f(e,l){const d=t.value;d[l]?d[l][e.serial_no]?(delete d[l][e.serial_no],o.add({severity:"info",summary:"已取消選課",detail:`${e.serial_no} ${e.course_name} (${l})`,life:3e3,group:u.value<768?"bottom":null})):(d[l][e.serial_no]=e,o.add({severity:"success",summary:"已選課",detail:`${e.serial_no} ${e.course_name} (${l})`,life:3e3,group:u.value<768?"bottom":null})):(d[l]={[e.serial_no]:e},o.add({severity:"success",summary:"已選課",detail:`${e.serial_no} ${e.course_name} (${l})`,life:3e3,group:u.value<768?"bottom":null}))}function v(e,l=null){var d;return l?t.value[l]&&((d=t.value[l])==null?void 0:d[e])||!1:a.value[e]||!1}function p(e,l){r.value.has(e)?(r.value.delete(e),o.add({severity:"info",summary:"已取消收藏",detail:`${e} ${l}`,life:3e3,group:u.value<768?"bottom":null})):(r.value.add(e),o.add({severity:"success",summary:"已收藏",detail:`${e} ${l}`,life:3e3,group:u.value<768?"bottom":null}))}function h(e){return r.value.has(e)}return{selectedCourses:t,selectedRows:a,selectCode:r,toast:o,windowWidth:u,selectCourse:m,selectCourseWithTerm:f,checkSelectedCourse:v,selectCodeHandler:p,checkSelectCode:h}}export{L as a,F as u};
