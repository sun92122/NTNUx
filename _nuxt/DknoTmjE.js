import H from"./CvBXU8zM.js";import P from"./CrQLwvWi.js";import Q from"./BSHFDt2D.js";import{_ as W,r as _,t as y,v as h,x as t,z as n,H as M,I as T,y as u,B as b,J as s,K as J,A as c,L as B,M as j,N as x,o as K,O as z,P as f,Q as X}from"./CfwhfPex.js";import Y from"./M2Fkkc2v.js";import Z from"./PfVgRMaB.js";import ee from"./Dj3OpsKH.js";import le from"./H1b3J7Af.js";import"./BCSdVUSF.js";import te from"./aLT8Jb_2.js";import ae from"./BAtNC9Ht.js";import oe from"./B5DqubkB.js";import se from"./L1qZYPXm.js";import re from"./BVVRGgYo.js";import"./CtnyzYNd.js";import ne from"./CcFcEhuy.js";import N from"./CvXCd1kk.js";import"./DIIjXHmK.js";import"./CudGMZax.js";import"./t50hXdBm.js";import"./Hcr0ZZvd.js";import"./B2ZplXc-.js";import"./DSf9gL7c.js";import"./DoAuwy03.js";import"./DQhbRPHb.js";import"./6VITeEcd.js";import"./DPKoOgxk.js";import"./BRNb_S0W.js";import"./BMnWyEF-.js";import"./BweX1uxR.js";import"./DSYaw7pH.js";import"./CRMm6x9o.js";import"./BzAXeQII.js";import"./j_cH9NRr.js";import"./CBx4TRlv.js";import"./B4840Rc0.js";import"./CM8SAFh2.js";import"./BOYRWFYC.js";import"./Dj1S2yGz.js";import"./CDY7K8HN.js";import"./1-QzBn33.js";import"./DjHuFEmX.js";import"./oqfRYKjn.js";import"./Da6TDcj5.js";const ie={class:"schedule-box"},ce={class:"timetable"},ue={class:"row header-row"},de={class:"cell time-cell"},me={__name:"floatingSchedule",props:{selectedRows:{type:Array,default:()=>[]}},setup(a){const S=a,C=["一","二","三","四","五"],U=[{label:"0",time:"07:10 ~ 08:00"},{label:"1",time:"08:10 ~ 09:00"},{label:"2",time:"09:10 ~ 10:00"},{label:"3",time:"10:20 ~ 11:10"},{label:"4",time:"11:20 ~ 12:10"},{label:"5",time:"12:20 ~ 13:10"},{label:"6",time:"13:20 ~ 14:10"},{label:"7",time:"14:20 ~ 15:10"},{label:"8",time:"15:30 ~ 16:20"},{label:"9",time:"16:30 ~ 17:20"},{label:"10",time:"17:30 ~ 18:20"},{label:"A",time:"18:30 ~ 19:25"},{label:"B",time:"19:35 ~ 20:25"},{label:"C",time:"20:30 ~ 21:20"},{label:"D",time:"21:25 ~ 22:15"}];function k(i){const r=[];if(typeof i!="object"||!i)return r;for(const o of Object.keys(i)){const d=o.match(/([一二三四五])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(d){const[A,$,F,L]=d,R=m(F,L||F);for(const V of R)r.push({day:$,period:V,loc:i[o]})}}return r}function m(i,r){const o=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],d=o.indexOf(i),A=o.indexOf(r);return o.slice(d,A+1)}const g=_({});function E(){g.value={};for(const i of S.selectedRows){const r=k(i.time_loc||"");for(const o of r)g.value[o.day]||(g.value[o.day]={}),g.value[o.day][o.period]||(g.value[o.day][o.period]=[]),g.value[o.day][o.period].push({...i,loc:o.loc})}}E();const D=_({});function O(i){const r=["#FFDD57","#87CEEB","#FF7F7F","#90EE90","#DDA0DD","#FFA07A","#00CED1","#F4A460","#B0E0E6","#FFB6C1"],o=Array.from(i).reduce((d,A)=>d+A.charCodeAt(0),0);return r[o%r.length]}function G(i){return i in D.value||(D.value[i]=O(i)),D.value[i]}_(null);const w=_([{label:"顏色",icon:"pi pi-palette",command:i=>{}}]);return(i,r)=>(h(),y(M,null,[t("div",ie,[t("div",ce,[t("div",ue,[r[0]||(r[0]=t("div",{class:"cell time-cell"},null,-1)),(h(),y(M,null,T(C,o=>t("div",{key:o,class:"cell"},u(o),1)),64))]),(h(),y(M,null,T(U,o=>t("div",{key:o.label,class:"row"},[t("div",de,[b(u(o.label),1),r[1]||(r[1]=t("br",null,null,-1)),t("small",null,u(o.time),1)]),(h(),y(M,null,T(C,d=>{var A;return t("div",{key:d,class:"cell"},[(h(!0),y(M,null,T(((A=s(g)[d])==null?void 0:A[o.label])||[],$=>(h(),y("div",{key:$.serial_no,class:"course-block",style:J({backgroundColor:G($.serial_no)})},[b(u($.chn_name.replace(/<\/?br>/g," "))+" ",1),r[2]||(r[2]=t("br",null,null,-1)),b(" "+u($.teacher)+" ",1),r[3]||(r[3]=t("br",null,null,-1)),b(" "+u($.loc),1)],4))),128))])}),64))])),64))])]),n(s(ne),{model:s(w),direction:"up",style:{position:"absolute",right:"-2.5rem",bottom:"1.5rem"},buttonProps:{severity:"secondary",rounded:!0},tooltipOptions:{position:"left"}},null,8,["model"])],64))}},ve=W(me,[["__scopeId","data-v-6fb71c29"]]),fe={class:"course-row"},pe={class:"course-cell course-code"},he={class:"course-cell course-title"},be={class:"course-name"},ge=["href"],ye={class:"message-group"},_e={class:"course-cell"},Ce={class:"message-group"},Ae={class:"course-cell course-comment"},$e={key:0},Ne={key:1},we={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(a){const S={必:"必修",選:"選修",通:"通識"},C={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(U,k)=>(h(),y("div",fe,[t("div",pe,[t("span",null,u(a.course.serial_no),1),t("span",null,u(a.course.course_code),1)]),t("div",he,[t("span",be,[t("a",{href:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${a.course.acadm_year}&term=${a.course.acadm_term}&courseCode=${a.course.course_code}&courseGroup=${a.course.course_group}&deptCode=${a.course.dept_code}&formS=${a.course.form_s}&classes1=${a.course.classes}&deptGroup=${a.course.dept_group_name}`,target:"_blank"},u(a.course.course_name),9,ge)]),t("div",ye,[n(s(N),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(a.course.dept_chiabbr),1)]),_:1}),n(s(N),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(a.course.teacher),1)]),_:1}),n(s(N),{icon:"pi pi-clock",severity:a.course.time.match(/.* 1[-/$]/)?"warn":"secondary",class:"custom-message"},{default:c(()=>[b(u(a.course.time),1)]),_:1},8,["severity"]),n(s(N),{icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(a.course.location),1)]),_:1})])]),t("div",_e,[t("div",Ce,[n(s(N),{icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(S[a.course.option_code]||a.course.option_code),1)]),_:1}),a.course.generalCore?(h(!0),y(M,{key:0},T(a.course.generalCore.split("/"),m=>(h(),j(s(N),{key:m,icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(C[m]||m),1)]),_:2},1024))),128)):B("",!0),n(s(N),{icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(Math.floor(a.course.credit))+" 學分",1)]),_:1}),n(s(N),{icon:"pi pi-users",severity:"secondary",class:"custom-message"},{default:c(()=>[b(u(`${a.course.limit_count_h} 人`),1)]),_:1}),a.course.eng_teach==="是"?(h(),j(s(N),{key:1,severity:"error",class:"custom-message"},{default:c(()=>k[0]||(k[0]=[b("英文授課")])),_:1})):B("",!0)])]),t("div",Ae,[a.course.restrict?(h(),y("span",$e,u(a.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):B("",!0),a.course.comment?(h(),y("span",Ne,u(a.course.comment.replace(/<\/br>/g,`
`)),1)):B("",!0)])]))}},Me={class:"tabs-container"},ke={class:"container"},Oe={class:"search-container search-bar"},Se={key:0,class:"search-input multi-search-input-sub-filter"},De={class:"grid-container"},Cl={__name:"index",setup(a){const S=x("terms",()=>[]),C=x("currentTerm",()=>null),U=x("loadTermData"),k=x("updateMenubar");K(async()=>{const e=await(await fetch("data/terms.json")).json();S.value=e.terms,C.value=S.value[e.defaultIndex],k.value(),U.value=V,U.value()});const m=_({value:null,filter_field:null,select_list:[],label:null}),g=_({global:{value:null,matchMode:f.CONTAINS},option_code:{value:null,matchMode:f.EQUALS},course_name:{value:null,matchMode:f.CONTAINS},chn_name:{value:null,matchMode:f.CONTAINS},dept_chiabbr:{value:null,matchMode:f.CONTAINS},eng_teach:{value:null,matchMode:f.EQUALS},generalCore:{operator:z.OR,constraints:[]},dept_code:{operator:z.OR,constraints:[]}}),E=["course_name","teacher","serial_no"],D=_(!1),O=_(!0),G=_({}),w=_([]),i=_([]),r=_("quick"),o=[{label:"快速搜尋",value:"quick",command:()=>{d({})}},{label:"通識",value:"general",command:()=>{d({option_code:"通"},{label:"選擇通識領域",select_list:[{label:"人文藝術",value:{value:"A1UG",matchMode:f.CONTAINS}},{label:"社會科學",value:{value:"A2UG",matchMode:f.CONTAINS}},{label:"自然科學",value:{value:"A3UG",matchMode:f.CONTAINS}},{label:"邏輯運算",value:{value:"A4UG",matchMode:f.CONTAINS}},{label:"學院共同課程",value:{value:"B1UG",matchMode:f.CONTAINS}},{label:"跨域專業探索課程",value:{value:"B2UG",matchMode:f.CONTAINS}},{label:"大學入門",value:{value:"B3UG",matchMode:f.CONTAINS}},{label:"專題探究",value:{value:"C1UG",matchMode:f.CONTAINS}},{label:"MOOCs",value:{value:"C2UG",matchMode:f.CONTAINS}}],filter_field:"generalCore"})},filter_field:["course_name"]},{label:"體育",activeLabel:"普通體育",value:"physical",command:()=>{d({dept_chiabbr:"普通體育"})}},{label:"國防",activeLabel:"全民國防教育",value:"Defense",command:()=>{d({chn_name:"全民國防"})}},{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",command:()=>{d({dept_chiabbr:"校際"},{label:"選擇開課學校",select_list:[{label:"國立臺灣大學",value:{value:"AA",matchMode:f.ENDS_WITH}},{label:"國立臺灣科技大學",value:{value:"AB",matchMode:f.ENDS_WITH}}],filter_field:"dept_code"})}},{label:"學分學程",value:"program",command:()=>{d({chn_name:"學分學程"})}},{label:"英文三",value:"english",command:()=>{d({course_name:"英文（三）"})}},{label:"英文授課",value:"EMI",command:()=>{d({eng_teach:"是"})}},{label:"",value:"quick",command:()=>{d({})}}];function d(p,e=null){const l=g.value;for(const v in l)v!=="global"&&(v in p?l[v].value=p[v]:(l[v].value&&(l[v].value=null),l[v].constraints&&(l[v].constraints=[])));e?(m.value.value=null,m.value.filter_field=e.filter_field,m.value.select_list=e.select_list,m.value.label=e.label):m.value.filter_field=null}async function A(p){const e=await fetch(`data/${C.value}/${p}.min.json`);if(!e.ok)return null;const l=await e.json();return l.length===0?null:l.map(v=>({...v,course_name:v.chn_name.replace(/<\/br>.*/g,""),time:L(v.time_loc),location:R(v.time_loc),teacher:F(v.teacher),generalCore:v.generalCore.join("/")}))}async function $(){const p=[];for(let e=0;e<10;e++)p.push(A(e));for await(const e of p)e&&(w.value=w.value.concat(e),O.value=!1)}function F(p){return p.replace("","温")}function L(p){const e=[];for(const[l,v]of Object.entries(p)){const[I,q]=l.split(" ");e.push(`${I} ${q}`)}return e.join("/")}function R(p){const e=[];for(const[v,I]of Object.entries(p))I!==""&&e.push(I);const l=[...new Set(e)];return l.length===1?l[0]:e.join("/")}async function V(){if(O.value=!0,G.value[C.value]){w.value=G.value[C.value],O.value=!1;return}w.value=[],i.value=[],await $().then(()=>{O.value=!1}),G.value[C.value]=w.value,k.value()}return(p,e)=>(h(),y(M,null,[t("div",Me,[n(s(Z),{value:r.value,"onUpdate:value":e[0]||(e[0]=l=>r.value=l),scrollable:""},{default:c(()=>[n(s(le),null,{default:c(()=>[(h(),y(M,null,T(o,l=>n(s(ee),{key:l.value,value:l.value,onClick:v=>l.command?l.command():null},{default:c(()=>[b(u(r.value==l.value&&l.activeLabel||l.label),1)]),_:2},1032,["value","onClick"])),64))]),_:1})]),_:1},8,["value"])]),t("div",ke,[t("div",Oe,[n(s(te),{variant:"in",class:X(["search-input",m.value.filter_field?"multi-search-input-main-filter":"single-search-input"])},{default:c(()=>[n(s(ae),null,{default:c(()=>[n(s(oe),null,{default:c(()=>e[5]||(e[5]=[t("i",{class:"pi pi-search"},null,-1)])),_:1}),n(s(se),{id:"globalFilter",modelValue:g.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value.global.value=l),autocapitalize:!1,size:"large",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e[6]||(e[6]=t("label",{for:"globalFilter"},"課程名稱/教師/開課序號",-1))]),_:1},8,["class"]),m.value.filter_field?(h(),y("div",Se,[n(s(re),{id:"sub-filter",modelValue:m.value.value,"onUpdate:modelValue":e[2]||(e[2]=l=>m.value.value=l),options:m.value.select_list,optionLabel:"label",optionValue:"value",style:{width:"100%"},showClear:!0,showToggleAll:!1,showFilter:!0,placeholder:m.value.label,display:"chip",onChange:e[3]||(e[3]=l=>{g.value[m.value.filter_field].constraints=l.value||[{value:null,matchMode:s(f).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):B("",!0)]),t("div",De,[n(s(H),{value:w.value,paginator:!0,filters:g.value,"global-filter-fields":r.value.filter_field||E,showGridlines:!0,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 20rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:O.value},{header:c(()=>e[7]||(e[7]=[t("span",null,"課程資訊",-1)])),loading:c(()=>[n(s(Q),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:c(()=>e[8]||(e[8]=[t("div",{class:"flex align-items-center justify-content-center"},[t("i",{class:"pi pi-exclamation-triangle mr-2"}),t("span",null,"沒有符合條件的課程")],-1)])),default:c(()=>[n(s(P),{sortable:!1},{body:c(({data:l})=>[n(s(we),{course:l},null,8,["course"])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])]),n(s(Y),{visible:D.value,"onUpdate:visible":e[4]||(e[4]=l=>D.value=l),maximizable:"",modal:"",header:"Header",style:{width:"50rem",height:"80vh"},"content-style":{margin:"0 0 1rem"},breakpoints:{"1199px":"75vw","575px":"90vw"}},{default:c(()=>[n(s(ve),{selectedRows:i.value},null,8,["selectedRows"])]),_:1},8,["visible"])],64))}};export{Cl as default};
