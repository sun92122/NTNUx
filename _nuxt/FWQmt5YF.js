import{_ as O,V as q,r as h,C as U,o as R,t as c,E as e,x as l,z as i,H as J,I as p,W as K,y as d,A as u,X,v as n,K as k,F as z,G as S,J as g,Y as V,Z as b,$ as x,O as B,a0 as w,B as D}from"./CM7FQ7N2.js";import{u as Y}from"./C5-c6c7O.js";import{u as Z}from"./GspWRFvF.js";import{u as P}from"./CoeiXtoY.js";import Q from"./BRtysnR4.js";const ee={key:0,class:"course-details"},te={class:"course-details-subtitle"},oe={class:"course-details-subtitle-right"},se={class:"course-info-first"},ae={class:"course-info-item"},le={style:{flex:"1",display:"flex","flex-direction":"column"}},re={style:{color:"var(--p-surface-500)","font-size":"12px"}},ie={style:{"font-size":"1.25rem"}},ne={style:{flex:"1",display:"flex","flex-direction":"column"}},ce={style:{color:"var(--p-surface-500)","font-size":"12px"}},ue={style:{"font-size":"1.25rem"}},de={key:0,class:"course-info-item"},pe={style:{"font-size":"1.1rem"}},fe={key:1,class:"course-info-item"},me={style:{"font-size":"1.1rem"}},_e={key:2,class:"course-info-item"},ve={style:{display:"flex",flexDirection:"row",gap:"2rem"}},ye={style:{minWidth:"20%"}},he={style:{fontSize:"1.1rem",marginBottom:"0.5rem"}},ge={class:"course-info-item",style:{fontSize:"1.2rem",fontFamily:"sans-serif",alignItems:"flex-end",gap:"0.2rem"}},be={key:0,style:{fontSize:"1.75rem",fontWeight:"900"}},xe={key:1},we={key:0,class:"course-info-item",style:{"flex-direction":"column"}},$e=["innerHTML"],Ce=["src"],ke={key:1,class:"course-details"},ze={__name:"course",setup(Se){const m=q(),{tempDatas:f,initTermData:T,courseFormatter:N}=Y(),{windowWidth:I,selectCourseWithTerm:A,checkSelectedCourse:M,selectCodeHandler:E,checkSelectCode:G}=Z(),t=h({year:m.query.year,term:m.query.term,serial_no:m.query.id}),$=h(!1),_=h(!1),v=h([]),W={必:"必修",選:"選修",通:"通識"},H={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};t.value.year&&t.value.term&&t.value.serial_no?L():console.error("Missing course parameters",{year:t.value.year,term:t.value.term,serial_no:t.value.serial_no});function L(){const o=U("rowDatas",()=>({})),s=`${t.value.year}-${t.value.term}`;function r(){setTimeout(()=>{j(t.value.course_code).then(a=>{t.value.description=a,P({title:`${s} ${t.value.course_name} | NTNUx`,meta:[{name:"description",content:a?a.brief||a.description:""},{name:"viewport",content:"width=device-width, initial-scale=1"}]})})})}if(o.value[s]){for(const a of o.value[s])if(a.serial_no===t.value.serial_no){t.value={...a,description:null},v.value=C(t.value),r();return}}if(f.value[s]&&f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]){for(const a of f.value[s][Math.floor(t.value.serial_no/1e3)+1])if(a.serial_no===t.value.serial_no){t.value={...N(a),description:null},v.value=C(t.value),r();return}}fetch(`data/${s}/${(Math.floor(t.value.serial_no/1e3)+1)%10}.min.json`).then(a=>a.json()).then(async a=>{f.value[s]=f.value[s]||{},f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]=a;for(const y of a)if(y.serial_no===t.value.serial_no){t.value={...N(y),description:null},v.value=C(t.value),r();return}console.error("Course not found in fetched data")}).catch(a=>{console.error("Error fetching course data:",a)})}async function j(o){return await fetch("https://cors.ntnux.org/?course_code="+o).then(async r=>{const a=await r.json();return a&&a.data&&a.data.length>0?{description:a.data[0].CourseDescription||"",brief:a.data[0].brief||""}:(console.error("Description not found in response",a),"No description available.")}).catch(r=>(console.error("Error fetching course description:",r),"Error fetching description."))}function C(o){return[{label:"開課序號",icon:"pi pi-hashtag",value:o.serial_no},{label:"科目代碼",icon:"pi pi-code",value:o.course_code},{label:"開課單位",icon:"pi pi-building",value:o.dept_chiabbr},{icon:"pi pi-objects-column",value:W[o.option_code]||o.option_code,childen:o.generalCore?o.generalCore.split("/").map(s=>H[s]||s):[]},{icon:"pi pi-graduation-cap",value:`${o.credit} 學分`,isNullValue:!o.credit},{label:"授課教師",icon:"pi pi-user",value:o.teacher||"無",isNullValue:!o.teacher},{label:"上課時間",icon:"pi pi-clock",value:o.time||"無",isNullValue:!o.time},{label:"上課地點",icon:"pi pi-map-marker",value:o.location||"無",isNullValue:!o.location},{icon:"pi pi-language",value:o.eng_teach==="是"?"英文授課":o.comment.match(/◎*語\s*授課/)?"國家語言授課":"中文授課"},{label:typeof o.programs=="string"&&o.programs.split("/").length===1?"學分學程":"",icon:"pi pi-book",value:typeof o.programs=="string"?o.programs.split("/").length>1?`${o.programs.split("/").length} 個學分學程`:o.programs:"無學分學程",isNullValue:typeof o.programs!="string"||o.programs==="",childen:typeof o.programs=="string"&&o.programs.split("/").length>1?o.programs.split("/"):[]}]}function F(){_.value=!0,setTimeout(()=>{_.value=!1,$.value=!0},500)}return R(async()=>{const o=U("updateMenubar");await T(m),o.value()}),(o,s)=>e(t).course_name?(n(),c("div",ee,[l("h1",null,d(e(t).course_name),1),l("div",te,[l("p",null,d(e(t).acadm_year)+"-"+d(e(t).acadm_term)+" 開課",1),l("div",oe,[i(e(k),{icon:e(G)(e(t).course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(G)(e(t).course_code)?"danger":"secondary",variant:"text",onClick:s[0]||(s[0]=r=>e(E)(e(t).course_code,e(t).course_name)),rounded:""},null,8,["icon","severity"]),i(e(k),{label:e(M)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"取消":"加入",severity:e(M)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"warn":"secondary",onClick:s[1]||(s[1]=r=>e(A)(e(t),`${e(t).acadm_year}-${e(t).acadm_term}`))},null,8,["label","severity"])])]),i(e(Q),{class:"course-card"},{content:u(()=>[l("div",se,[(n(!0),c(z,null,S(e(v),r=>(n(),c("div",{key:r.label},[r.childen&&r.childen.length>0?(n(),c("div",{key:0,class:"course-info-item",style:g({color:r.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[i(e(V),{value:"1",style:{width:"100%"}},{default:u(()=>[i(e(b),{value:"1",style:{width:"100%",border:"0"}},{default:u(()=>[i(e(x),{style:{padding:"0",width:"100%"}},{default:u(()=>[l("div",ae,[l("i",{class:B(r.icon),style:{"font-size":"1.2rem"}},null,2),l("div",le,[l("span",re,d(r.label),1),l("span",ie,d(r.value||""),1)])])]),_:2},1024),i(e(w),{style:{"--p-accordion-content-padding":"0 1.25rem"}},{default:u(()=>[(n(!0),c(z,null,S(r.childen,a=>(n(),c("div",{key:a,style:{margin:"0.5rem 0",fontSize:"1.1rem"}},[l("span",null,d(a),1)]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)],4)):(n(),c("div",{key:1,class:"course-info-item",style:g({color:r.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[l("i",{class:B(r.icon),style:{"font-size":"1.2rem"}},null,2),l("div",ne,[l("span",ce,d(r.label),1),l("span",ue,d(r.value||""),1)])],4))]))),128))]),l("div",{class:"course-info-second",style:g(e(I)<600?{"--p-accordion-content-padding":"0 0 1.125rem 0"}:{})},[i(e(V),{multiple:"",value:["1","2","3"]},{default:u(()=>[i(e(b),{value:"1"},{default:u(()=>[i(e(x),{style:{fontSize:"1.25rem"}},{default:u(()=>s[2]||(s[2]=[D(" 備註/限修 ")])),_:1}),i(e(w),null,{default:u(()=>[e(t).comment?(n(),c("div",de,[s[3]||(s[3]=l("i",{class:"pi pi-comment",style:{"font-size":"1.2rem"}},null,-1)),l("span",pe,d(e(t).comment),1)])):p("",!0),e(t).restrict?(n(),c("div",fe,[s[4]||(s[4]=l("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"1.2rem"}},null,-1)),l("span",me,d(e(t).restrict),1)])):p("",!0),!e(t).comment&&!e(t).restrict?(n(),c("div",_e,s[5]||(s[5]=[l("span",{style:{"font-size":"1.1rem",color:"var(--p-surface-500)"}},"無",-1)]))):p("",!0)]),_:1})]),_:1}),i(e(b),{value:"2"},{default:u(()=>[i(e(x),{style:{fontSize:"1.25rem"}},{default:u(()=>s[6]||(s[6]=[D(" 選課資訊 ")])),_:1}),i(e(w),null,{default:u(()=>[l("div",ve,[(n(!0),c(z,null,S([["選課總人數",e(t).counter_exceptAuth,e(t).limit_count_h],["已使用授權碼",e(t).counter-e(t).counter_exceptAuth,e(t).authorize_p],["系統各校開放名額",null,e(t).limit]],([r,a,y])=>(n(),c("div",ye,[l("div",he,[l("span",null,d(r),1)]),l("div",ge,[a!==null?(n(),c("div",be,d(a),1)):p("",!0),a!==null?(n(),c("div",xe,"/")):p("",!0),l("div",{style:g({fontSize:a!==null?"1.2rem":"1.75rem",fontWeight:a!==null?"400":"900"})},d(y),5)])]))),256))])]),_:1})]),_:1}),i(e(b),{value:"3"},{default:u(()=>[i(e(x),{style:{fontSize:"1.25rem"}},{default:u(()=>s[7]||(s[7]=[D(" 課程簡介 ")])),_:1}),i(e(w),null,{default:u(()=>[e(t).description?(n(),c("div",we,[l("span",{innerHTML:e(t).description.brief||e(t).description.description,style:{"font-size":"1.1rem","white-space":"pre-wrap","text-indent":"2em"}},null,8,$e)])):p("",!0)]),_:1})]),_:1})]),_:1})],4)]),_:1}),!e($)||e(_)?(n(),J(e(k),{key:0,label:"顯示課程大綱",icon:"pi pi-file",severity:"contrast",variant:"outlined",onClick:F,loading:e(_),style:{marginTop:"20px",width:"100%"}},null,8,["loading"])):p("",!0),K(l("iframe",{src:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${e(t).acadm_year}&term=${e(t).acadm_term}&courseCode=${e(t).course_code}&courseGroup=${e(t).course_group}&deptCode=${e(t).dept_code}&formS=${e(t).form_s}&classes1=${e(t).classes}&deptGroup=${e(t).dept_group_name}`,width:"100%",height:"600px",frameborder:"0",style:{"margin-top":"20px",background:"#fff"}},null,8,Ce),[[X,e($)]])])):(n(),c("div",ke,s[8]||(s[8]=[l("h2",null,"Loading course details...",-1)])))}},Ve=O(ze,[["__scopeId","data-v-e3493ace"]]);export{Ve as default};
