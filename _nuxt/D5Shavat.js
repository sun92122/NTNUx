import{_ as F,V as q,r as b,C as V,o as R,t as c,E as e,x as r,z as i,H as J,I as m,W as K,y as d,A as u,X,J as _,v as n,K as z,F as S,G as D,Y as T,Z as x,$ as w,O as B,a0 as $,B as N}from"./C3oQwdnR.js";import{u as Y}from"./BT_WmsSP.js";import{u as Z}from"./CSmN6QzK.js";import{u as P}from"./DkwySGjf.js";import Q from"./CsBZLywa.js";const ee={key:0,class:"course-details"},te={class:"course-details-subtitle"},oe={class:"course-details-subtitle-right"},se={class:"course-info-first"},ae={class:"course-info-item"},re={style:{flex:"1",display:"flex","flex-direction":"column"}},le={style:{color:"var(--p-surface-500)","font-size":"12px"}},ie={style:{"font-size":"1.25rem"}},ne={style:{flex:"1",display:"flex","flex-direction":"column"}},ce={style:{color:"var(--p-surface-500)","font-size":"12px"}},ue={style:{"font-size":"1.25rem"}},de={key:0,class:"course-info-item"},pe={style:{"font-size":"1.1rem"}},me={key:1,class:"course-info-item"},fe={style:{"font-size":"1.1rem"}},_e={key:2,class:"course-info-item"},ve={style:{display:"flex",flexDirection:"row",gap:"2rem"}},ye={style:{minWidth:"20%"}},he={style:{fontSize:"1.1rem",marginBottom:"0.5rem"}},ge={class:"course-info-item",style:{fontSize:"1.2rem",fontFamily:"sans-serif",alignItems:"flex-end",gap:"0.2rem"}},be={key:0,style:{fontSize:"1.75rem",fontWeight:"900"}},xe={key:1},we={key:0,class:"course-info-item",style:{"flex-direction":"column"}},$e=["innerHTML"],ke=["src","width","height"],Ce={key:1,class:"course-details"},ze={__name:"course",setup(Se){const v=q(),{tempDatas:f,initTermData:I,courseFormatter:M}=Y(),{windowWidth:p,selectCourseWithTerm:A,checkSelectedCourse:G,selectCodeHandler:E,checkSelectCode:U}=Z(),t=b({year:v.query.year,term:v.query.term,serial_no:v.query.id}),k=b(!1),y=b(!1),h=b([]),L={必:"必修",選:"選修",通:"通識"},W={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};t.value.year&&t.value.term&&t.value.serial_no?H():console.error("Missing course parameters",{year:t.value.year,term:t.value.term,serial_no:t.value.serial_no});function H(){const o=V("rowDatas",()=>({})),s=`${t.value.year}-${t.value.term}`;function l(){setTimeout(()=>{O(t.value.course_code).then(a=>{t.value.description=a,P({title:`${s} ${t.value.course_name} | NTNUx`,meta:[{name:"description",content:a?a.brief||a.description:""},{name:"viewport",content:"width=device-width, initial-scale=1"}]})})})}if(o.value[s]){for(const a of o.value[s])if(a.serial_no===t.value.serial_no){t.value={...a,description:null},h.value=C(t.value),l();return}}if(f.value[s]&&f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]){for(const a of f.value[s][Math.floor(t.value.serial_no/1e3)+1])if(a.serial_no===t.value.serial_no){t.value={...M(a),description:null},h.value=C(t.value),l();return}}fetch(`data/${s}/${(Math.floor(t.value.serial_no/1e3)+1)%10}.min.json`).then(a=>a.json()).then(async a=>{f.value[s]=f.value[s]||{},f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]=a;for(const g of a)if(g.serial_no===t.value.serial_no){t.value={...M(g),description:null},h.value=C(t.value),l();return}console.error("Course not found in fetched data")}).catch(a=>{console.error("Error fetching course data:",a)})}async function O(o){return await fetch("https://cors.ntnux.org/?course_code="+o).then(async l=>{const a=await l.json();return a&&a.data&&a.data.length>0?{description:a.data[0].CourseDescription||"",brief:a.data[0].brief||""}:(console.error("Description not found in response",a),"No description available.")}).catch(l=>(console.error("Error fetching course description:",l),"Error fetching description."))}function C(o){return[{label:"開課序號",icon:"pi pi-hashtag",value:o.serial_no},{label:"科目代碼",icon:"pi pi-code",value:o.course_code},{label:"開課單位",icon:"pi pi-building",value:o.dept_chiabbr},{icon:"pi pi-objects-column",value:L[o.option_code]||o.option_code,childen:o.generalCore?o.generalCore.split("/").map(s=>W[s]||s):[]},{icon:"pi pi-graduation-cap",value:`${o.credit} 學分`,isNullValue:!o.credit},{label:"授課教師",icon:"pi pi-user",value:o.teacher||"無",isNullValue:!o.teacher},{label:"上課時間",icon:"pi pi-clock",value:o.time||"無",isNullValue:!o.time},{label:"上課地點",icon:"pi pi-map-marker",value:o.location||"無",isNullValue:!o.location},{icon:"pi pi-language",value:o.eng_teach==="是"?"英文授課":o.comment.match(/◎*語\s*授課/)?"國家語言授課":"中文授課"},{label:typeof o.programs=="string"&&o.programs.split("/").length===1?"學分學程":"",icon:"pi pi-book",value:typeof o.programs=="string"?o.programs.split("/").length>1?`${o.programs.split("/").length} 個學分學程`:o.programs:"無學分學程",isNullValue:typeof o.programs!="string"||o.programs==="",childen:typeof o.programs=="string"&&o.programs.split("/").length>1?o.programs.split("/"):[]}]}function j(){y.value=!0,setTimeout(()=>{y.value=!1,k.value=!0},500)}return R(async()=>{const o=V("updateMenubar");await I(v),o.value()}),(o,s)=>e(t).course_name?(n(),c("div",ee,[r("h1",null,d(e(t).course_name),1),r("div",te,[r("p",null,d(e(t).acadm_year)+"-"+d(e(t).acadm_term)+" 開課",1),r("div",oe,[i(e(z),{icon:e(U)(e(t).course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(U)(e(t).course_code)?"danger":"secondary",variant:"text",onClick:s[0]||(s[0]=l=>e(E)(e(t).course_code,e(t).course_name)),rounded:""},null,8,["icon","severity"]),i(e(z),{label:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"取消":"加入",severity:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"warn":"secondary",onClick:s[1]||(s[1]=l=>e(A)(e(t),`${e(t).acadm_year}-${e(t).acadm_term}`))},null,8,["label","severity"])])]),i(e(Q),{class:"course-card"},{content:u(()=>[r("div",se,[(n(!0),c(S,null,D(e(h),l=>(n(),c("div",{key:l.label},[l.childen&&l.childen.length>0?(n(),c("div",{key:0,class:"course-info-item",style:_({color:l.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[i(e(T),{value:"1",style:{width:"100%"}},{default:u(()=>[i(e(x),{value:"1",style:{width:"100%",border:"0"}},{default:u(()=>[i(e(w),{style:{padding:"0",width:"100%"}},{default:u(()=>[r("div",ae,[r("i",{class:B(l.icon),style:{"font-size":"1.2rem"}},null,2),r("div",re,[r("span",le,d(l.label),1),r("span",ie,d(l.value||""),1)])])]),_:2},1024),i(e($),{style:{"--p-accordion-content-padding":"0 1.25rem"}},{default:u(()=>[(n(!0),c(S,null,D(l.childen,a=>(n(),c("div",{key:a,style:{margin:"0.5rem 0",fontSize:"1.1rem"}},[r("span",null,d(a),1)]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)],4)):(n(),c("div",{key:1,class:"course-info-item",style:_({color:l.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[r("i",{class:B(l.icon),style:{"font-size":"1.2rem"}},null,2),r("div",ne,[r("span",ce,d(l.label),1),r("span",ue,d(l.value||""),1)])],4))]))),128))]),r("div",{class:"course-info-second",style:_(e(p)<600?{"--p-accordion-content-padding":"0 0 1.125rem 0"}:{})},[i(e(T),{multiple:"",value:["1","2","3"]},{default:u(()=>[i(e(x),{value:"1"},{default:u(()=>[i(e(w),{style:{fontSize:"1.25rem"}},{default:u(()=>s[2]||(s[2]=[N(" 備註/限修 ")])),_:1}),i(e($),null,{default:u(()=>[e(t).comment?(n(),c("div",de,[s[3]||(s[3]=r("i",{class:"pi pi-comment",style:{"font-size":"1.2rem"}},null,-1)),r("span",pe,d(e(t).comment),1)])):m("",!0),e(t).restrict?(n(),c("div",me,[s[4]||(s[4]=r("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"1.2rem"}},null,-1)),r("span",fe,d(e(t).restrict),1)])):m("",!0),!e(t).comment&&!e(t).restrict?(n(),c("div",_e,s[5]||(s[5]=[r("span",{style:{"font-size":"1.1rem",color:"var(--p-surface-500)"}},"無",-1)]))):m("",!0)]),_:1})]),_:1}),i(e(x),{value:"2"},{default:u(()=>[i(e(w),{style:{fontSize:"1.25rem"}},{default:u(()=>s[6]||(s[6]=[N(" 選課資訊 ")])),_:1}),i(e($),null,{default:u(()=>[r("div",ve,[(n(!0),c(S,null,D([["選課總人數",e(t).counter_exceptAuth,e(t).limit_count_h],["已使用授權碼",e(t).counter-e(t).counter_exceptAuth,e(t).authorize_p],["系統各校開放名額",null,e(t).limit]],([l,a,g])=>(n(),c("div",ye,[r("div",he,[r("span",null,d(l),1)]),r("div",ge,[a!==null?(n(),c("div",be,d(a),1)):m("",!0),a!==null?(n(),c("div",xe,"/")):m("",!0),r("div",{style:_({fontSize:a!==null?"1.2rem":"1.75rem",fontWeight:a!==null?"400":"900"})},d(g),5)])]))),256))])]),_:1})]),_:1}),i(e(x),{value:"3"},{default:u(()=>[i(e(w),{style:{fontSize:"1.25rem"}},{default:u(()=>s[7]||(s[7]=[N(" 課程簡介 ")])),_:1}),i(e($),null,{default:u(()=>[e(t).description?(n(),c("div",we,[r("span",{innerHTML:e(t).description.brief||e(t).description.description,style:{"font-size":"1.1rem","white-space":"pre-wrap","text-indent":"2em"}},null,8,$e)])):m("",!0)]),_:1})]),_:1})]),_:1})],4)]),_:1}),!e(k)||e(y)?(n(),J(e(z),{key:0,label:"顯示課程大綱",icon:"pi pi-file",severity:"contrast",variant:"outlined",onClick:j,loading:e(y),style:{marginTop:"20px",width:"100%"}},null,8,["loading"])):m("",!0),K(r("iframe",{src:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${e(t).acadm_year}&term=${e(t).acadm_term}&courseCode=${e(t).course_code}&courseGroup=${e(t).course_group}&deptCode=${e(t).dept_code}&formS=${e(t).form_s}&classes1=${e(t).classes}&deptGroup=${e(t).dept_group_name}`,width:e(p)<950?"950px":"100%",height:e(p)<950?"2000px":"800px",frameborder:"0",style:_({marginTop:"20px",background:"#fff","-webkit-transform":`scale(${e(p)<950?(e(p)-10)/950:1})`,"-moz-transform":`scale(${e(p)<950?(e(p)-10)/950:1})`,transformOrigin:"top left",marginLeft:"auto",marginRight:"auto"})},null,12,ke),[[X,e(k)]])])):(n(),c("div",Ce,s[8]||(s[8]=[r("h2",null,"Loading course details...",-1)])))}},Ve=F(ze,[["__scopeId","data-v-1ab6c240"]]);export{Ve as default};
