import{g as se,t as y,v as c,x as u,y as d,z as n,A as s,B as h,E as t,O as B,F as w,I as k,G,H as F,C as S,r as R,P as v,o as oe,e as re,D as ie,Q as ne,R as ce,S as H,T as i,J as ue,K as de,L as z,U as P,V as ve}from"./Dwet-AYz.js";import{u as me}from"./CS-h0mOq.js";import{u as pe}from"./DDdbwRCF.js";import _ from"./CA5XkpEE.js";import fe from"./BJc7uU3l.js";import he from"./DGc7I0Ba.js";import ge from"./FICf8fy2.js";import be from"./C50J8U1x.js";import ye from"./BgpwEZ33.js";import _e from"./CN7ZChvf.js";import ke from"./Di-mhW2y.js";import"./MiYZmaeN.js";import"./CB4iEyFl.js";import"./BhwnrBIH.js";const Ce={class:"course-row"},Oe={class:"course-cell course-code"},we={class:"course-cell course-title"},Se={class:"course-name"},Re={class:"message-group"},Ae={class:"course-cell"},$e={class:"message-group"},Me={class:"course-cell course-comment"},Ne={key:0},Te={key:1},Ue={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(a){const x={必:"必修",選:"選修",通:"通識"},C={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(A,$)=>{const L=se("router-link");return c(),y("div",Ce,[u("div",Oe,[u("span",null,d(a.course.serial_no),1),u("span",null,d(a.course.course_code),1)]),u("div",we,[u("span",Se,[n(t(B),{variant:"link",size:"large",asChild:""},{default:s(()=>[n(L,{to:{name:"course",query:{year:a.course.acadm_year,term:a.course.acadm_term,id:a.course.serial_no}}},{default:s(()=>[h(d(a.course.course_name),1)]),_:1},8,["to"])]),_:1})]),u("div",Re,[n(t(_),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(a.course.dept_chiabbr),1)]),_:1}),n(t(_),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(a.course.teacher),1)]),_:1}),a.course.time?(c(),w(t(_),{key:0,icon:"pi pi-clock",severity:a.course.time.match(/.* (0|1)([-/\n\r]|$)/)?"warn":"secondary",class:"custom-message"},{default:s(()=>[h(d(a.course.time),1)]),_:1},8,["severity"])):k("",!0),a.course.location?(c(),w(t(_),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(a.course.location),1)]),_:1})):k("",!0)])]),u("div",Ae,[u("div",$e,[n(t(_),{severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(a.course.credit)+" 學分",1)]),_:1}),n(t(_),{severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(x[a.course.option_code]||a.course.option_code),1)]),_:1}),a.course.generalCore?(c(!0),y(G,{key:0},F(a.course.generalCore.split("/"),O=>(c(),w(t(_),{key:O,icon:"pi pi-objects-column",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(C[O]||O),1)]),_:2},1024))),128)):k("",!0),a.course.programs?(c(!0),y(G,{key:1},F(a.course.programs.split("/"),O=>(c(),w(t(_),{key:O,icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(O),1)]),_:2},1024))),128)):k("",!0),n(t(_),{icon:"pi pi-users",severity:a.course.limit_count_h>0?"secondary":"warn",class:"custom-message"},{default:s(()=>[h(d(`${a.course.limit_count_h} 人`),1)]),_:1},8,["severity"]),a.course.eng_teach==="是"?(c(),w(t(_),{key:2,severity:"error",class:"custom-message"},{default:s(()=>$[0]||($[0]=[h("英文授課")])),_:1})):k("",!0)])]),u("div",Me,[a.course.restrict?(c(),y("span",Ne,d(a.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):k("",!0),a.course.comment?(c(),y("span",Te,d(a.course.comment.replace(/<\/br>/g,`
`)),1)):k("",!0)])])}}},Ge={class:"tabs-container"},xe={class:"container"},Le={class:"search-container search-bar"},Ve={key:0,class:"global-filter-label",for:"globalFilter"},Ie={key:1,class:"global-filter-label advanced-search-label",for:"globalFilter"},qe={key:0,class:"search-input multi-search-input-sub-filter"},Be={key:1,class:"search-input multi-search-input-sub-filter"},Fe={class:"grid-container"},Ee={style:{display:"flex",gap:"0.5rem","flex-wrap":"wrap","justify-content":"center"}},je=null,al={__name:"index",setup(a){const x=ce(),C=ie(),{currentTerm:A,rowData:$,loading:L,programSet:O,defaultGlobalFilterFields:Q,initTermData:K}=me(),{selectedCourses:V,selectedRows:W,selectCourse:J,checkSelectedCourse:E,selectCodeHandler:Y,checkSelectCode:j}=pe(),X=S("updateMenubar"),Z=S("deptList"),ee=S("isShowSchedule",()=>!1),M=S("isShowAdvancedSearch",()=>!1),N=R(null),le=S("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),T=R(null),I=S("advancedSearchRebuildFunction"),g=R(""),o=R({value:null,filter_field:null,select_list:null,grouped_select_list:null,label:null}),m=S("filters",()=>({global:{value:je,matchMode:v.CONTAINS},option_code:{operator:i.OR,constraints:[]},course_name:{operator:i.OR,constraints:[]},chn_name:{operator:i.OR,constraints:[]},dept_chiabbr:{operator:i.OR,constraints:[]},eng_teach:{operator:i.OR,constraints:[]},generalCore:{operator:i.OR,constraints:[]},dept_code:{operator:i.OR,constraints:[]},time_inf:{operator:i.OR,constraints:[]},time_loc:{operator:i.OR,constraints:[]},timeListStr:{operator:i.OR,constraints:[]},comment:{operator:i.OR,constraints:[]},credit:{operator:i.OR,constraints:[]},programs:{operator:i.OR,constraints:[]}})),q=R({quick:{label:"快速搜尋",value:"quick",command:()=>b({})},dept:{label:"系所",value:"dept",command:()=>b({dept_chiabbr:{operator:i.OR,constraints:[{value:null,matchMode:v.CONTAINS}]}},{label:"選擇開課單位",grouped_select_list:Z.value||{},filter_field:"dept_code"})},advanced:{label:"進階搜尋",value:"advanced",command:()=>{M.value=!0,b({}),m.value.global.value=null,I&&I.value&&I.value()}},general:{label:"通識",value:"general",command:()=>b({option_code:{operator:i.OR,constraints:[{value:"通",matchMode:v.EQUALS}]}},{label:"選擇通識領域",select_list:Object.entries({人文藝術:"A1UG",社會科學:"A2UG",自然科學:"A3UG",邏輯運算:"A4UG",學院共同課程:"B1UG",跨域專業探索課程:"B2UG",大學入門:"B3UG",專題探究:"C1UG",MOOCs:"C2UG"}).map(([r,e])=>({label:r,value:{value:e,matchMode:v.CONTAINS}})),filter_field:"generalCore"})},physical:{label:"體育",activeLabel:"普通體育",value:"physical",command:()=>b({dept_chiabbr:{operator:i.OR,constraints:[{value:"體育",matchMode:v.CONTAINS}]}})},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",command:()=>b({chn_name:{operator:i.OR,constraints:[{value:"全民國防",matchMode:v.CONTAINS}]}})},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",command:()=>b({dept_chiabbr:{operator:i.OR,constraints:[{value:"校際",matchMode:v.CONTAINS}]}},{label:"選擇開課學校",select_list:Object.entries({國立臺灣大學:"AA",國立臺灣科技大學:"AB"}).map(([r,e])=>({label:r,value:{value:e,matchMode:v.ENDS_WITH}})),filter_field:"dept_code"})},program:{label:"學分學程",value:"program",command:()=>b({chn_name:{operator:i.OR,constraints:[{value:"學分學程",matchMode:v.CONTAINS}]}},{label:"選擇學分學程",select_list:[...O.value].sort().map(r=>({label:r,value:{value:r,matchMode:v.CONTAINS}})),filter_field:"programs"})},english:{label:"英文三",value:"english",command:()=>b({course_name:{operator:i.OR,constraints:[{value:"英文（三）",matchMode:v.CONTAINS}]}})},emi:{label:"英文授課",value:"emi",command:()=>b({eng_teach:{operator:i.OR,constraints:[{value:"是",matchMode:v.EQUALS}]}})},"":{label:"",value:"quick",command:()=>b({})}});function te(){T.value&&(T.value.d_first=0)}function U(r){var l;if(M.value||ee.value||N.value&&N.value.overlayVisible)return 0;const e=(l=T.value)==null?void 0:l.$el.querySelector(".p-datatable-table-container");return e&&(e.scrollTop=Math.max(0,Math.min(e.scrollTop+r,e.scrollHeight-e.clientHeight)),e.scrollTop<e.scrollHeight-e.clientHeight&&e.scrollTop>0)?1:0}oe(async()=>{var l,p;const r=f=>{U(f.deltaY)&&f.preventDefault()},e=f=>{f.key==="Home"&&U(-1/0),f.key==="End"&&U(1/0)};window.addEventListener("wheel",r,{passive:!1}),window.addEventListener("keydown",e),re(()=>{window.removeEventListener("wheel",r),window.removeEventListener("keydown",e)}),await K(C),X.value(),g.value=((l=C.query.m)==null?void 0:l.toLowerCase())||"quick",C.query.s?m.value.global.value=C.query.s:m.value.global.value=null,q.value[g.value]?(p=q.value[g.value])==null||p.command():g.value="quick",V.value[A.value]||(V.value[A.value]={}),W.value=V.value[A.value]}),ne(()=>g.value,r=>{x.replace({path:C.path,query:{...C.query,m:r,s:m.value.global.value||null}})});function b(r,e=null){var l;for(const p in m.value)p!=="global"&&(p in r?m.value[p]=r[p]:(l=m.value[p]).constraints&&(l.constraints=[]));e?o.value={...o.value,value:null,filter_field:e.filter_field,select_list:e.select_list||null,grouped_select_list:e.grouped_select_list||null,label:e.label}:(o.value.select_list=null,o.value.grouped_select_list=null)}function D(){M.value=!0}function ae(){const r=o.value.value;if(!r||Object.keys(r).length===0){m.value[o.value.filter_field].constraints=[{value:null,matchMode:v.CONTAINS}];return}const e=o.value.grouped_select_list;m.value[o.value.filter_field].constraints=Object.entries(r).map(([l,p])=>{if(!p.checked)return{value:null,matchMode:v.CONTAINS};const f=l.split("-");return f.length===1?e[l].data:f.length===2?e[f[0]].children[f[1]].data:e[f[0]].children[f[1]].children[f[2]].data})}return(r,e)=>(c(),y(G,null,[u("div",Ge,[n(t(ge),{value:g.value,"onUpdate:value":[e[0]||(e[0]=l=>g.value=l),te],scrollable:""},{default:s(()=>[n(t(fe),null,{default:s(()=>[(c(!0),y(G,null,F(Object.values(q.value),l=>(c(),w(t(he),{key:l.value,value:l.value,onClick:p=>l.command?l.command():null,class:H(l.label?"":"tab-disabled")},{default:s(()=>[h(d(g.value==l.value&&l.activeLabel||l.label),1)]),_:2},1032,["value","onClick","class"]))),128))]),_:1})]),_:1},8,["value"])]),u("div",xe,[u("div",Le,[n(t(be),{variant:"in",class:H(["search-input",o.value.select_list||o.value.grouped_select_list?"multi-search-input-main-filter":"single-search-input"]),onClick:e[2]||(e[2]=l=>t(M)?D():null)},{default:s(()=>[n(t(ue),null,{default:s(()=>[n(t(de),null,{default:s(()=>e[8]||(e[8]=[u("i",{class:"pi pi-search"},null,-1)])),_:1}),g.value!="advanced"?(c(),w(t(z),{key:0,id:"globalFilter",modelValue:t(m).global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>t(m).global.value=l),autocapitalize:!1,size:"large",style:{width:"100%"}},null,8,["modelValue"])):(c(),w(t(z),{key:1,id:"globalFilter",value:"",readonly:"",autocapitalize:!1,size:"large",style:{width:"100%",cursor:"pointer"},onClick:D}))]),_:1}),g.value!="advanced"?(c(),y("label",Ve,"課程名稱/教師/開課序號")):(c(),y("label",Ie,d(t(le)||"點擊進行進階搜尋"),1))]),_:1},8,["class"]),o.value.select_list?(c(),y("div",qe,[n(t(ye),{ref_key:"subFilterRef",ref:N,id:"sub-filter",modelValue:o.value.value,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.value=l),options:o.value.select_list,optionLabel:"label",optionValue:"value",showClear:!0,showToggleAll:!1,filter:!0,placeholder:o.value.label,display:"chip",style:{width:"100%"},onChange:e[4]||(e[4]=l=>{t(m)[o.value.filter_field].constraints=l.value||[{value:null,matchMode:t(v).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):k("",!0),o.value.grouped_select_list?(c(),y("div",Be,[n(t(_e),{ref_key:"subFilterRef",ref:N,id:"sub-filter-grouped",modelValue:o.value.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.value=l),options:o.value.grouped_select_list,selectionMode:"checkbox",filter:"",filterMode:"strict",showClear:!0,placeholder:o.value.label,style:{width:"100%"},onChange:e[6]||(e[6]=l=>ae())},null,8,["modelValue","options","placeholder"])])):k("",!0)]),u("div",Fe,[n(t(ve),{ref_key:"scrollTableRef",ref:T,value:t($),paginator:!0,filters:t(m),"global-filter-fields":g.value.filter_field||t(Q),showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 22rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:t(L),style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"},onPage:e[7]||(e[7]=l=>U(-1/0))},{header:s(()=>e[9]||(e[9]=[u("span",null,"課程資訊",-1)])),loading:s(()=>[n(t(ke),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:s(()=>e[10]||(e[10]=[u("div",{class:"flex align-items-center justify-content-center"},[u("i",{class:"pi pi-exclamation-triangle mr-2"}),u("span",null,"沒有符合條件的課程")],-1)])),default:s(()=>[n(t(P),{sortable:!1},{body:s(({data:l})=>[n(t(Ue),{course:l},null,8,["course"])]),_:1}),n(t(P),{headerStyle:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center",paddingRight:"1rem"},header:""},{body:s(({data:l})=>[u("div",Ee,[n(t(B),{icon:t(j)(l.course_code)?"pi pi-heart-fill":"pi pi-heart",severity:t(j)(l.course_code)?"danger":"secondary",variant:"text",onClick:p=>t(Y)(l.course_code,l.course_name),rounded:""},null,8,["icon","severity","onClick"]),n(t(B),{label:t(E)(l.serial_no)?"取消":"加入",severity:t(E)(l.serial_no)?"warn":"secondary",onClick:p=>t(J)(l)},null,8,["label","severity","onClick"])])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])])],64))}};export{al as default};
