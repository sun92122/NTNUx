import{H as i}from"./CItEfQ8r.js";function _(){const e=i("terms",()=>[]),t=i("currentTerm",()=>null),r=i("loadTermData"),n=i("rowDatas",()=>({})),s=i("rowData",()=>[]),u=i("loading",()=>!0),v=["course_name","teacher","serial_no"],d=async c=>{const o=await fetch(`data/${t.value}/${c}.min.json`);if(!o.ok)return null;const l=await o.json();return l.length===0?null:(l.forEach(a=>{a.credit=Math.round(a.credit*10)/10,a.course_name=a.chn_name.replace(/<\/br>.*/g,""),a.time=m(a.time_loc),a.location=g(a.time_loc),a.timeLocList=D(a.time_loc),a.teacher=h(a.teacher),a.generalCore=a.generalCore.join("/")}),l.map(a=>({...a,timeListStr:y(a.timeLocList)})))},p=async()=>{const c=[];for(let o=0;o<10;o++)c.push(d(o));for await(const o of c)o&&(s.value=s.value.concat(o),u.value=!1)},f=async()=>{if(u.value=!0,n.value[t.value]){s.value=n.value[t.value],u.value=!1;return}s.value=[],await p(),n.value[t.value]=s.value};return{terms:e,currentTerm:t,rowData:s,loading:u,reloadCurrentTerm:f,defultGlobalFilterFields:v,initTermData:async c=>{if(e.value.length>0){u.value=!1;return}const l=await(await fetch("/data/terms.json")).json();e.value=l.terms,t.value=c.query.term,(!t.value||e.value.indexOf(t.value)===-1)&&(t.value=l.defaultValue),r.value=f,await f()}}}function h(e){return e.replace("","温")}function m(e){return typeof e=="string"?e:Object.entries(e).map(([t,r])=>t).join("/")}function g(e){if(typeof e=="string")return null;const t=Object.values(e).filter(n=>n!==""),r=[...new Set(t)];return r.length===1?r[0]:t.join("/")}function D(e){const t=[];if(typeof e!="object"||!e)return t;for(const r of Object.keys(e)){const n=r.match(/([一二三四五六])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(n){const[s,u,v,d]=n,p=w(v,d||v);for(const f of p)t.push({day:u,period:f,loc:e[r]})}}return t}function w(e,t){const r=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],n=r.indexOf(e),s=r.indexOf(t);return r.slice(n,s+1)}function y(e){return!Array.isArray(e)||e.length===0?"◎":e.map(({day:t,period:r})=>`${t}${r.replace("10","X")}`).join("/")}export{_ as u};
