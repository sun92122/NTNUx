import{g as z,v as p,x as u,y as a,z as l,A as c,B as o,C as i,H as e,L as k,G as b,J as y,M as E,N as B,_ as J,D as m,r as O,o as K,e as Q,E as W,O as Y,P as X,Q as Z,R as H,S as ee}from"./Ct6jwAdj.js";import{u as se}from"./Cv6AOdZ8.js";import{u as te}from"./CZpGKGlG.js";import d from"./L7C7MRSf.js";import{_ as re}from"./CRpNJCQ3.js";import oe from"./DDkeAfjW.js";import"./DL41zQXB.js";import"./CGMc7YdB.js";import"./i8iUhmuq.js";import"./BVPNpLSy.js";import"./Bd3N46ZI.js";import"./B-3vBYD6.js";import"./Bnu9wdUK.js";import"./ChymOOg_.js";import"./DaoITPqg.js";const ae={class:"course-row"},ce={class:"course-cell course-code"},le={class:"course-cell course-title"},ne={class:"course-name"},ie={class:"message-group"},ue={class:"course-cell"},de={class:"message-group"},me={class:"course-cell course-comment"},fe={key:0},ve={key:1},ye={__name:"CourseCell",props:{course:{type:Object,required:!0}},setup(s){const C={必:"必修",選:"選修",通:"通識"},h={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(U,w)=>{const S=z("router-link");return u(),p("div",ae,[a("div",ce,[a("span",null,l(s.course.serial_no),1),a("span",null,l(s.course.course_code),1)]),a("div",le,[a("span",ne,[c(e(k),{variant:"link",size:"large",asChild:""},{default:o(()=>[c(S,{to:{name:"course",query:{year:s.course.acadm_year,term:s.course.acadm_term,id:s.course.serial_no}}},{default:o(()=>[i(l(s.course.course_name),1)]),_:1},8,["to"])]),_:1})]),a("div",ie,[c(e(d),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.dept_chiabbr),1)]),_:1}),c(e(d),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.teacher),1)]),_:1}),s.course.time?(u(),b(e(d),{key:0,icon:"pi pi-clock",severity:s.course.time.match(/.* (0|1)([-/\n\r]|$)/)?"warn":"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.time),1)]),_:1},8,["severity"])):y("",!0),s.course.location?(u(),b(e(d),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.location),1)]),_:1})):y("",!0)])]),a("div",ue,[a("div",de,[c(e(d),{severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.credit)+" 學分",1)]),_:1}),c(e(d),{severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(C[s.course.option_code]||s.course.option_code),1)]),_:1}),s.course.generalCore?(u(!0),p(E,{key:0},B(s.course.generalCore.split("/"),f=>(u(),b(e(d),{key:f,icon:"pi pi-objects-column",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(h[f]||f),1)]),_:2},1024))),128)):y("",!0),s.course.programs?(u(!0),p(E,{key:1},B(s.course.programs.split("/"),f=>(u(),b(e(d),{key:f,icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(f),1)]),_:2},1024))),128)):y("",!0),c(e(d),{icon:"pi pi-users",severity:s.course.limit_count_h>0?"secondary":"warn",class:"custom-message"},{default:o(()=>[i(l(`${s.course.limit_count_h} 人`),1)]),_:1},8,["severity"]),s.course.eng_teach==="是"?(u(),b(e(d),{key:2,severity:"error",class:"custom-message"},{default:o(()=>w[0]||(w[0]=[i("英文授課")])),_:1})):y("",!0)])]),a("div",me,[s.course.restrict?(u(),p("span",fe,l(s.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):y("",!0),s.course.comment?(u(),p("span",ve,l(s.course.comment.replace(/<\/br>/g,`
`)),1)):y("",!0)])])}}},he={class:"container"},pe={class:"grid-container"},ge={class:"datatable-header"},be={class:"datatable-header-end"},we={style:{display:"flex",gap:"0.5rem","flex-wrap":"wrap","justify-content":"center"}},_e={__name:"index",setup(s){Y();const C=W(),{currentTerm:h,rowData:U,loading:w,defaultGlobalFilterFields:S,initTermData:f}=se(),{selectedCourses:x,selectedRows:L,selectCourse:N,checkSelectedCourse:G,selectCodeHandler:j,checkSelectCode:R}=te(),F=m("updateMenubar");m("deptList");const P=m("isShowSchedule",()=>!1),D=m("isShowAdvancedSearch",()=>!1),A=m("subFilterRef",()=>null),g=m("scrollTableRef",()=>null),$=m("lastUpdate",()=>({}));m("advancedSearchDisplayValue",()=>"點擊進行進階搜尋");const T=O("unknown"),V=O(""),I=m("filters",()=>({global:{value:null,matchMode:X.CONTAINS},...Object.fromEntries(["option_code","course_name","chn_name","dept_chiabbr","eng_teach","generalCore","dept_code","time_inf","time_loc","timeListStr","comment","credit","programs"].map(v=>[v,{operator:Z.OR,constraints:[]}]))}));function _(v){var r;if(D.value||P.value||A.value&&A.value.overlayVisible)return 0;const t=(r=g.value)==null?void 0:r.$el.querySelector(".p-datatable-table-container");return t&&(t.scrollTop=Math.max(0,Math.min(t.scrollTop+v,t.scrollHeight-t.clientHeight)),t.scrollTop<t.scrollHeight-t.clientHeight&&t.scrollTop>0)?1:0}function q(){g.value&&g.value.d_first!==void 0&&(g.value.d_first=0)}return K(async()=>{const v=n=>{_(n.deltaY)&&n.preventDefault()},t=n=>{n.key==="Home"&&_(-1/0),n.key==="End"&&_(1/0)};window.addEventListener("wheel",v,{passive:!1}),window.addEventListener("keydown",t),Q(()=>{window.removeEventListener("wheel",v),window.removeEventListener("keydown",t)}),await f(C),F.value(),x.value[h.value]||(x.value[h.value]={}),L.value=x.value[h.value];const[r,M]=h.value.split("-");$.value[r]||await fetch(`./data/update/${r}.json`).then(n=>{if(n.ok)return n.json();throw new Error("Network response was not ok")}).then(n=>{$.value[r]=n}).catch(n=>{console.error("Error fetching last update data:",n)}),T.value=$.value[r][M]||"unknown"}),(v,t)=>(u(),p("div",he,[c(e(re),{isSearchPage:!0,resetPage:q}),a("div",pe,[c(e(ee),{ref_key:"scrollTableRef",ref:g,value:e(U),paginator:!0,filters:e(I),"global-filter-fields":V.value.filter_field||e(S),showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 22rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:e(w),style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"},onPage:t[0]||(t[0]=r=>_(-1/0))},{header:o(()=>[a("div",ge,[t[1]||(t[1]=a("span",null,"課程資訊",-1)),a("div",be,[a("span",null,"最後更新："+l(T.value),1),c(e(k),{icon:"pi pi-cog",label:"顯示設定",variant:"text",severity:"secondary"})])])]),loading:o(()=>[c(e(oe),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:o(()=>t[2]||(t[2]=[a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-2"}),a("span",null,"沒有符合條件的課程")],-1)])),default:o(()=>[c(e(H),{sortable:!1},{body:o(({data:r})=>[c(e(ye),{course:r},null,8,["course"])]),_:1}),c(e(H),{headerStyle:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center",paddingRight:"1rem"},header:""},{body:o(({data:r})=>[a("div",we,[c(e(k),{icon:e(R)(r.course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(R)(r.course_code)?"danger":"secondary",variant:"text",onClick:M=>e(j)(r.course_code,r.course_name),rounded:""},null,8,["icon","severity","onClick"]),c(e(k),{label:e(G)(r.serial_no)?"取消":"加入",severity:e(G)(r.serial_no)?"warn":"secondary",onClick:M=>e(N)(r)},null,8,["label","severity","onClick"])])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])]))}},Le=J(_e,[["__scopeId","data-v-ae3f3523"]]);export{Le as default};
