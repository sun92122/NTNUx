import{u as z,T as j,D as d,P as i,Q as p,r as k,I as x,o as D,F as E,v as g,x as v,y as M,A as h,B as S,H as e,U as A,M as U,N as K,G as C,C as H,z as $,V as W,J as I,W as J,X,Y as R,Z as B}from"./DiLWiPl0.js";import{u as Y,a as Z}from"./CTrtmnpk.js";import Q from"./JoPJIJLl.js";import ee from"./BcK_b1T2.js";import le from"./DStiuprp.js";import ae from"./BXLsDyBW.js";import te from"./AW1lQm3q.js";import se from"./IZJForRl.js";const oe={class:"tabs-container"},ue={class:"search-container search-bar"},ie={key:0,class:"global-filter-label",for:"globalFilter"},re={key:1,class:"global-filter-label advanced-search-label",for:"globalFilter"},ne={key:0,class:"search-input multi-search-input-sub-filter"},ce={key:1,class:"search-input multi-search-input-sub-filter"},Se={__name:"CourseSearchBar",props:{isSearchPage:{type:Boolean,default:!1},resetPage:{type:Function,default:null}},setup(m){const y=z(),b=j(),{programSet:F}=Y();Z(),d("updateMenubar");const P=d("deptList");d("isShowSchedule",()=>!1);const N=d("isShowAdvancedSearch",()=>!1),V=d("subFilterRef",()=>null);d("scrollTableRef",()=>null);const s=d("filters",()=>({global:{value:null,matchMode:i.CONTAINS},...Object.fromEntries(["option_code","course_name","chn_name","dept_chiabbr","eng_teach","generalCore","dept_code","time_inf","time_loc","timeListStr","comment","credit","programs"].map(t=>[t,{operator:p.OR,constraints:[]}]))})),G=d("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),O=d("advancedSearchRebuildFunction"),u=k(""),o=k({value:null,filter_field:null,select_list:null,grouped_select_list:null,label:null}),f=k({quick:{label:"快速搜尋",value:"quick",route:"/?m=quick",command:()=>n({})},dept:{label:"系所",activeLabel:"開課系所",value:"dept",route:"/?m=dept",command:()=>n({dept_chiabbr:{operator:p.OR,constraints:[{value:null,matchMode:i.CONTAINS}]}},{label:"選擇開課單位",grouped_select_list:P.value||{},filter_field:"dept_code"})},advanced:{label:"進階搜尋",value:"advanced",route:"/?m=advanced",command:()=>{N.value=!0,n({}),s.value.global.value=null,O&&O.value&&O.value()}},general:{label:"通識",value:"general",route:"/?m=general",command:()=>n({option_code:{operator:p.OR,constraints:[{value:"通",matchMode:i.EQUALS}]}},{label:"選擇通識領域",select_list:Object.entries({人文藝術:"A1UG",社會科學:"A2UG",自然科學:"A3UG",邏輯運算:"A4UG",學院共同課程:"B1UG",跨域專業探索課程:"B2UG",大學入門:"B3UG",專題探究:"C1UG",MOOCs:"C2UG"}).map(([t,l])=>({label:t,value:{value:l,matchMode:i.CONTAINS}})),filter_field:"generalCore"})},physical:{label:"體育",activeLabel:"普通體育",value:"physical",route:"/?m=physical",command:()=>n({dept_chiabbr:{operator:p.OR,constraints:[{value:"體育",matchMode:i.CONTAINS}]}})},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",route:"/?m=defense",command:()=>n({chn_name:{operator:p.OR,constraints:[{value:"全民國防",matchMode:i.CONTAINS}]}})},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",route:"/?m=interschool",command:()=>n({dept_chiabbr:{operator:p.OR,constraints:[{value:"校際",matchMode:i.CONTAINS}]}},{label:"選擇開課學校",select_list:Object.entries({國立臺灣大學:"AA",國立臺灣科技大學:"AB"}).map(([t,l])=>({label:t,value:{value:l,matchMode:i.ENDS_WITH}})),filter_field:"dept_code"})},program:{label:"學分學程",value:"program",route:"/?m=program",command:()=>n({chn_name:{operator:p.OR,constraints:[{value:"學分學程",matchMode:i.CONTAINS}]}},{label:"選擇學分學程",select_list:[...F.value].sort().map(t=>({label:t,value:{value:t,matchMode:i.CONTAINS}})),filter_field:"programs"})},english:{label:"英文三",value:"english",route:"/?m=english",command:()=>n({course_name:{operator:p.OR,constraints:[{value:"英文（三）",matchMode:i.CONTAINS}]}})},emi:{label:"英文授課",value:"emi",route:"/?m=emi",command:()=>n({eng_teach:{operator:p.OR,constraints:[{value:"是",matchMode:i.EQUALS}]}})},"":{label:"",value:"quick",route:"/?m=quick",command:()=>n({})}});function n(t,l=null){var a,c,r;x({title:((a=f.value[u.value])==null?void 0:a.activeLabel)||((c=f.value[u.value])==null?void 0:c.label)||"",description:"更適合師大人的課程查詢系統，更快、更強、行動裝置友好。"});for(const _ in s.value)_!=="global"&&(_ in t?s.value[_]=t[_]:(r=s.value[_]).constraints&&(r.constraints=[]));l?o.value={...o.value,value:null,filter_field:l.filter_field,select_list:l.select_list||null,grouped_select_list:l.grouped_select_list||null,label:l.label}:(o.value.select_list=null,o.value.grouped_select_list=null)}function q(){N.value=!0}function w(){const t=o.value.value;if(!t||Object.keys(t).length===0){s.value[o.value.filter_field].constraints=[{value:null,matchMode:i.CONTAINS}];return}const l=o.value.grouped_select_list;s.value[o.value.filter_field].constraints=Object.entries(t).map(([a,c])=>{if(!c.checked)return{value:null,matchMode:i.CONTAINS};const r=a.split("-");return r.length===1?l[a].data:r.length===2?l[r[0]].children[r[1]].data:l[r[0]].children[r[1]].children[r[2]].data})}function T(){if(s.value.global.value){const t=d("routerLoading",()=>!1);t.value=!0,y.push(`/?s=${s.value.global.value}`)}}function L({path:t=null,m:l=null,s:a=null}){var c,r;t||(t=b.path),l||(l=u.value||void 0),a||(a=((r=(c=s.value)==null?void 0:c.global)==null?void 0:r.value)||void 0),y.replace({path:t,query:{...b.query,m:l,s:a}})}return D(()=>{var t;u.value=b.query.m||"quick",f.value[u.value]?(t=f.value[u.value])==null||t.command():u.value="quick",b.query.s?s.value.global.value=b.query.s:s.value.global.value=null}),E(()=>b.query,t=>{var l;t.m&&(f.value[t.m]?(u.value=t.m,(l=f.value[t.m])==null||l.command()):u.value="quick"),t.s?s.value.global.value=t.s:s.value.global.value=null},{immediate:!0}),(t,l)=>(v(),g(U,null,[M("div",oe,[h(e(le),{value:e(u),"onUpdate:value":[l[0]||(l[0]=a=>W(u)?u.value=a:null),l[1]||(l[1]=()=>{var a,c;e(f)[e(u)]&&((c=(a=e(f)[e(u)]).command)==null||c.call(a)),m.resetPage&&m.resetPage(),m.isSearchPage?e(y).push({query:{...e(b).query,m:e(u)}}):e(y).push({path:"/",query:{...e(b).query,m:e(u),s:e(s).global.value||void 0}})})],scrollable:""},{default:S(()=>[h(e(Q),{class:A(m.isSearchPage?"":"tab-disabled")},{default:S(()=>[(v(!0),g(U,null,K(Object.values(e(f)),a=>(v(),C(e(ee),{key:a.value,value:a.value,class:A(m.isSearchPage&&a.label?"":"tab-disabled")},{default:S(()=>[H($(e(u)==a.value&&a.activeLabel||a.label),1)]),_:2},1032,["value","class"]))),128))]),_:1},8,["class"])]),_:1},8,["value"])]),M("div",ue,[h(e(ae),{variant:"in",class:A(["search-input",e(o).select_list||e(o).grouped_select_list?"multi-search-input-main-filter":"single-search-input"]),onClick:l[8]||(l[8]=a=>e(N)?q():null)},{default:S(()=>[h(e(J),null,{default:S(()=>[h(e(X),null,{default:S(()=>l[13]||(l[13]=[M("i",{class:"pi pi-search"},null,-1)])),_:1}),m.isSearchPage&&e(u)!="advanced"?(v(),C(e(R),{key:0,id:"globalFilter",modelValue:e(s).global.value,"onUpdate:modelValue":l[2]||(l[2]=a=>e(s).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"},onBlur:l[3]||(l[3]=a=>L({s:e(s).global.value})),onKeyup:l[4]||(l[4]=B(a=>L({s:e(s).global.value}),["enter"]))},null,8,["modelValue"])):m.isSearchPage?(v(),C(e(R),{key:1,id:"globalFilter",value:"",readonly:"",autocapitalize:!1,size:"large",style:{width:"100%",cursor:"pointer"},onClick:q})):(v(),C(e(R),{key:2,id:"globalFilter",modelValue:e(s).global.value,"onUpdate:modelValue":l[5]||(l[5]=a=>e(s).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"},onBlur:l[6]||(l[6]=a=>T()),onKeyup:l[7]||(l[7]=B(a=>T(),["enter"]))},null,8,["modelValue"]))]),_:1}),e(u)!="advanced"?(v(),g("label",ie,"課程名稱/教師/開課序號")):(v(),g("label",re,$(e(G)||"點擊進行進階搜尋"),1))]),_:1},8,["class"]),m.isSearchPage&&e(o).select_list?(v(),g("div",ne,[h(e(te),{ref_key:"subFilterRef",ref:V,id:"sub-filter",modelValue:e(o).value,"onUpdate:modelValue":l[9]||(l[9]=a=>e(o).value=a),options:e(o).select_list,optionLabel:"label",optionValue:"value",showClear:!0,showToggleAll:!1,filter:!0,placeholder:e(o).label,display:"chip",style:{width:"100%"},onChange:l[10]||(l[10]=a=>{e(s)[e(o).filter_field].constraints=a.value||[{value:null,matchMode:e(i).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):I("",!0),m.isSearchPage&&e(o).grouped_select_list?(v(),g("div",ce,[h(e(se),{ref_key:"subFilterRef",ref:V,id:"sub-filter-grouped",modelValue:e(o).value,"onUpdate:modelValue":l[11]||(l[11]=a=>e(o).value=a),options:e(o).grouped_select_list,selectionMode:"checkbox",filter:"",filterMode:"strict",showClear:!0,placeholder:e(o).label,style:{width:"100%"},onChange:l[12]||(l[12]=a=>w())},null,8,["modelValue","options","placeholder"])])):I("",!0)])],64))}};export{Se as _};
