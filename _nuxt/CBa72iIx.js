import{_ as F,W as q,r as w,C as V,o as R,t as n,E as e,x as r,z as c,F as X,I as m,X as Y,y as d,A as u,Y as Z,N as _,v as i,O as z,G as S,H as N,Z as T,$ as x,a0 as b,S as B,a1 as $,B as D}from"./Dwet-AYz.js";import{u as J}from"./CS-h0mOq.js";import{u as K}from"./DDdbwRCF.js";import{u as P}from"./CWUKTzWb.js";import Q from"./B_2zUAHe.js";const ee={class:"course-details-container"},te={key:0,class:"course-details"},oe={class:"course-details-subtitle"},se={class:"course-details-subtitle-right"},ae={class:"course-info-first"},re={class:"course-info-item"},le={style:{flex:"1",display:"flex","flex-direction":"column"}},ie={style:{color:"var(--p-surface-500)","font-size":"12px"}},ne={style:{"font-size":"1.25rem"}},ce={style:{flex:"1",display:"flex","flex-direction":"column"}},ue={style:{color:"var(--p-surface-500)","font-size":"12px"}},de={style:{"font-size":"1.25rem"}},pe={key:0,class:"course-info-item"},me={style:{"font-size":"1.1rem"}},fe={key:1,class:"course-info-item"},_e={style:{"font-size":"1.1rem"}},ve={key:2,class:"course-info-item"},ye={style:{display:"flex",flexDirection:"row",gap:"clamp(0.5rem, 3vw - 0.5rem, 2rem)"}},he={style:{minWidth:"20%"}},ge={style:{fontSize:"clamp(1rem, 2vw + 0.25rem, 1.2rem)",marginBottom:"0.5rem"}},we={class:"course-info-item",style:{fontSize:"1.2rem",fontFamily:"sans-serif",alignItems:"flex-end",gap:"0.2rem"}},xe={key:0,style:{fontSize:"1.75rem",fontWeight:"900"}},be={key:1},$e={key:0,class:"course-info-item",style:{"flex-direction":"column"}},ke=["innerHTML"],Ce=["src","width","height"],ze={key:1,class:"course-details"},Se={__name:"course",setup(Ne){const v=q(),{tempDatas:f,initTermData:I,courseFormatter:M}=J(),{windowWidth:p,selectCourseWithTerm:A,checkSelectedCourse:G,selectCodeHandler:E,checkSelectCode:U}=K(),t=w({year:v.query.year,term:v.query.term,serial_no:v.query.id}),k=w(!1),y=w(!1),h=w([]),L={必:"必修",選:"選修",通:"通識"},W={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};t.value.year&&t.value.term&&t.value.serial_no?H():console.error("Missing course parameters",{year:t.value.year,term:t.value.term,serial_no:t.value.serial_no});function H(){const o=V("rowDatas",()=>({})),s=`${t.value.year}-${t.value.term}`;function l(){setTimeout(()=>{O(t.value.course_code).then(a=>{t.value.description=a,P({title:`${s} ${t.value.course_name} | NTNUx`,meta:[{name:"description",content:a?a.brief||a.description:""},{name:"viewport",content:"width=device-width, initial-scale=1"}]})})})}if(o.value[s]){for(const a of o.value[s])if(a.serial_no===t.value.serial_no){t.value={...a,description:null},h.value=C(t.value),l();return}}if(f.value[s]&&f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]){for(const a of f.value[s][Math.floor(t.value.serial_no/1e3)+1])if(a.serial_no===t.value.serial_no){t.value={...M(a),description:null},h.value=C(t.value),l();return}}fetch(`data/${s}/${(Math.floor(t.value.serial_no/1e3)+1)%10}.min.json`).then(a=>a.json()).then(async a=>{f.value[s]=f.value[s]||{},f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]=a;for(const g of a)if(g.serial_no===t.value.serial_no){t.value={...M(g),description:null},h.value=C(t.value),l();return}console.error("Course not found in fetched data")}).catch(a=>{console.error("Error fetching course data:",a)})}async function O(o){return await fetch("https://cors.ntnux.org/?course_code="+o).then(async l=>{const a=await l.json();return a&&a.data&&a.data.length>0?{description:a.data[0].CourseDescription||"",brief:a.data[0].brief||""}:(console.error("Description not found in response",a),"No description available.")}).catch(l=>(console.error("Error fetching course description:",l),"Error fetching description."))}function C(o){return[{label:"開課序號",icon:"pi pi-hashtag",value:o.serial_no},{label:"科目代碼",icon:"pi pi-code",value:o.course_code},{label:"開課單位",icon:"pi pi-building",value:o.dept_chiabbr},{icon:"pi pi-objects-column",value:L[o.option_code]||o.option_code,childen:o.generalCore?o.generalCore.split("/").map(s=>W[s]||s):[]},{icon:"pi pi-graduation-cap",value:`${o.credit} 學分`,isNullValue:!o.credit},{label:"授課教師",icon:"pi pi-user",value:o.teacher||"無",isNullValue:!o.teacher},{label:"上課時間",icon:"pi pi-clock",value:o.time||"無",isNullValue:!o.time},{label:"上課地點",icon:"pi pi-map-marker",value:o.location||"無",isNullValue:!o.location},{icon:"pi pi-language",value:o.eng_teach==="是"?"英文授課":o.comment.match(/◎*語\s*授課/)?"國家語言授課":"中文授課"},{label:typeof o.programs=="string"&&o.programs.split("/").length===1?"學分學程":"",icon:"pi pi-book",value:typeof o.programs=="string"?o.programs.split("/").length>1?`${o.programs.split("/").length} 個學分學程`:o.programs:"無學分學程",isNullValue:typeof o.programs!="string"||o.programs==="",childen:typeof o.programs=="string"&&o.programs.split("/").length>1?o.programs.split("/"):[]}]}function j(){y.value=!0,setTimeout(()=>{y.value=!1,k.value=!0},500)}return R(async()=>{const o=V("updateMenubar");await I(v),o.value()}),(o,s)=>(i(),n("div",ee,[e(t).course_name?(i(),n("div",te,[r("h1",null,d(e(t).course_name),1),r("div",oe,[r("p",null,d(e(t).acadm_year)+"-"+d(e(t).acadm_term)+" 開課",1),r("div",se,[c(e(z),{icon:e(U)(e(t).course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(U)(e(t).course_code)?"danger":"secondary",variant:"text",onClick:s[0]||(s[0]=l=>e(E)(e(t).course_code,e(t).course_name)),rounded:""},null,8,["icon","severity"]),c(e(z),{label:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"取消":"加入",severity:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"warn":"secondary",onClick:s[1]||(s[1]=l=>e(A)(e(t),`${e(t).acadm_year}-${e(t).acadm_term}`))},null,8,["label","severity"])])]),c(e(Q),{class:"course-card"},{content:u(()=>[r("div",ae,[(i(!0),n(S,null,N(e(h),l=>(i(),n("div",{key:l.label},[l.childen&&l.childen.length>0?(i(),n("div",{key:0,class:"course-info-item",style:_({color:l.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[c(e(T),{value:"1",style:{width:"100%"}},{default:u(()=>[c(e(x),{value:"1",style:{width:"100%",border:"0"}},{default:u(()=>[c(e(b),{style:{padding:"0",width:"100%"}},{default:u(()=>[r("div",re,[r("i",{class:B(l.icon),style:{"font-size":"1.2rem"}},null,2),r("div",le,[r("span",ie,d(l.label),1),r("span",ne,d(l.value||""),1)])])]),_:2},1024),c(e($),{style:{"--p-accordion-content-padding":"0 1.25rem"}},{default:u(()=>[(i(!0),n(S,null,N(l.childen,a=>(i(),n("div",{key:a,style:{margin:"0.5rem 0",fontSize:"1.1rem"}},[r("span",null,d(a),1)]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)],4)):(i(),n("div",{key:1,class:"course-info-item",style:_({color:l.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[r("i",{class:B(l.icon),style:{"font-size":"1.2rem"}},null,2),r("div",ce,[r("span",ue,d(l.label),1),r("span",de,d(l.value||""),1)])],4))]))),128))]),r("div",{class:"course-info-second",style:_(e(p)<600?{"--p-accordion-content-padding":"0 0 1.125rem 0"}:{})},[c(e(T),{multiple:"",value:["1","2","3"]},{default:u(()=>[c(e(x),{value:"1"},{default:u(()=>[c(e(b),{style:{fontSize:"1.25rem"}},{default:u(()=>s[2]||(s[2]=[D(" 備註/限修 ")])),_:1}),c(e($),null,{default:u(()=>[e(t).comment?(i(),n("div",pe,[s[3]||(s[3]=r("i",{class:"pi pi-comment",style:{"font-size":"1.2rem"}},null,-1)),r("span",me,d(e(t).comment),1)])):m("",!0),e(t).restrict?(i(),n("div",fe,[s[4]||(s[4]=r("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"1.2rem"}},null,-1)),r("span",_e,d(e(t).restrict),1)])):m("",!0),!e(t).comment&&!e(t).restrict?(i(),n("div",ve,s[5]||(s[5]=[r("span",{style:{"font-size":"1.1rem",color:"var(--p-surface-500)"}},"無",-1)]))):m("",!0)]),_:1})]),_:1}),c(e(x),{value:"2"},{default:u(()=>[c(e(b),{style:{fontSize:"1.25rem"}},{default:u(()=>s[6]||(s[6]=[D(" 選課資訊 ")])),_:1}),c(e($),null,{default:u(()=>[r("div",ye,[(i(!0),n(S,null,N([["選課總人數",e(t).counter_exceptAuth,e(t).limit_count_h],["已使用授權碼",e(t).counter-e(t).counter_exceptAuth,e(t).authorize_p],["系統各校開放名額",null,e(t).limit]],([l,a,g])=>(i(),n("div",he,[r("div",ge,[r("span",null,d(l),1)]),r("div",we,[a!==null?(i(),n("div",xe,d(a),1)):m("",!0),a!==null?(i(),n("div",be,"/")):m("",!0),r("div",{style:_({fontSize:a!==null?"1.2rem":"1.75rem",fontWeight:a!==null?"400":"900"})},d(g),5)])]))),256))])]),_:1})]),_:1}),c(e(x),{value:"3"},{default:u(()=>[c(e(b),{style:{fontSize:"1.25rem"}},{default:u(()=>s[7]||(s[7]=[D(" 課程簡介 ")])),_:1}),c(e($),null,{default:u(()=>[e(t).description?(i(),n("div",$e,[r("span",{innerHTML:e(t).description.brief||e(t).description.description,style:{"font-size":"1.1rem","white-space":"pre-wrap","text-indent":"2em"}},null,8,ke)])):m("",!0)]),_:1})]),_:1})]),_:1})],4)]),_:1}),!e(k)||e(y)?(i(),X(e(z),{key:0,label:"顯示課程大綱",icon:"pi pi-file",severity:"contrast",variant:"outlined",onClick:j,loading:e(y),style:{marginTop:"20px",width:"100%"}},null,8,["loading"])):m("",!0),Y(r("div",{style:_({height:e(p)<950?(e(p)-10)/950*2e3+"px":"800px",overflow:"hidden"})},[r("iframe",{src:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${e(t).acadm_year}&term=${e(t).acadm_term}&courseCode=${e(t).course_code}&courseGroup=${e(t).course_group}&deptCode=${e(t).dept_code}&formS=${e(t).form_s}&classes1=${e(t).classes}&deptGroup=${e(t).dept_group_name}`,width:e(p)<950?"950px":"100%",height:e(p)<950?"2000px":"800px",frameborder:"0",style:_({marginTop:"20px",background:"#fff","-webkit-transform":`scale(${e(p)<950?(e(p)-10)/950:1})`,"-moz-transform":`scale(${e(p)<950?(e(p)-10)/950:1})`,transformOrigin:"top left",marginLeft:"auto",marginRight:"auto"})},null,12,Ce)],4),[[Z,e(k)]])])):(i(),n("div",ze,s[8]||(s[8]=[r("h2",null,"Loading course details...",-1)])))]))}},Te=F(Se,[["__scopeId","data-v-d0ef1354"]]);export{Te as default};
