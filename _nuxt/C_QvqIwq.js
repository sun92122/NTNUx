import{g as V,v as y,x as n,y as a,z as l,A as c,B as o,C as i,H as e,L as S,G as p,J as v,M as R,N as A,D as m,r as j,o as I,e as q,E as z,O as J,P as K,Q,R as T,S as W}from"./DiLWiPl0.js";import{u as Y,a as X}from"./CTrtmnpk.js";import u from"./ioSpbdxZ.js";import{_ as Z}from"./D6vIZvhe.js";import ee from"./BGcr4V2V.js";import"./JoPJIJLl.js";import"./BSqxwEZU.js";import"./BcK_b1T2.js";import"./DStiuprp.js";import"./BXLsDyBW.js";import"./AW1lQm3q.js";import"./BnYmzFhh.js";import"./IZJForRl.js";import"./DLl7NKuB.js";const se={class:"course-row"},te={class:"course-cell course-code"},re={class:"course-cell course-title"},oe={class:"course-name"},ae={class:"message-group"},ce={class:"course-cell"},le={class:"message-group"},ie={class:"course-cell course-comment"},ne={key:0},ue={key:1},de={__name:"CourseCell",props:{course:{type:Object,required:!0}},setup(s){const _={必:"必修",選:"選修",通:"通識"},g={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(x,b)=>{const k=V("router-link");return n(),y("div",se,[a("div",te,[a("span",null,l(s.course.serial_no),1),a("span",null,l(s.course.course_code),1)]),a("div",re,[a("span",oe,[c(e(S),{variant:"link",size:"large",asChild:""},{default:o(()=>[c(k,{to:{name:"course",query:{year:s.course.acadm_year,term:s.course.acadm_term,id:s.course.serial_no}}},{default:o(()=>[i(l(s.course.course_name),1)]),_:1},8,["to"])]),_:1})]),a("div",ae,[c(e(u),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.dept_chiabbr),1)]),_:1}),c(e(u),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.teacher),1)]),_:1}),s.course.time?(n(),p(e(u),{key:0,icon:"pi pi-clock",severity:s.course.time.match(/.* (0|1)([-/\n\r]|$)/)?"warn":"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.time),1)]),_:1},8,["severity"])):v("",!0),s.course.location?(n(),p(e(u),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.location),1)]),_:1})):v("",!0)])]),a("div",ce,[a("div",le,[c(e(u),{severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(s.course.credit)+" 學分",1)]),_:1}),c(e(u),{severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(_[s.course.option_code]||s.course.option_code),1)]),_:1}),s.course.generalCore?(n(!0),y(R,{key:0},A(s.course.generalCore.split("/"),d=>(n(),p(e(u),{key:d,icon:"pi pi-objects-column",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(g[d]||d),1)]),_:2},1024))),128)):v("",!0),s.course.programs?(n(!0),y(R,{key:1},A(s.course.programs.split("/"),d=>(n(),p(e(u),{key:d,icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:o(()=>[i(l(d),1)]),_:2},1024))),128)):v("",!0),c(e(u),{icon:"pi pi-users",severity:s.course.limit_count_h>0?"secondary":"warn",class:"custom-message"},{default:o(()=>[i(l(`${s.course.limit_count_h} 人`),1)]),_:1},8,["severity"]),s.course.eng_teach==="是"?(n(),p(e(u),{key:2,severity:"error",class:"custom-message"},{default:o(()=>b[0]||(b[0]=[i("英文授課")])),_:1})):v("",!0)])]),a("div",ie,[s.course.restrict?(n(),y("span",ne,l(s.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):v("",!0),s.course.comment?(n(),y("span",ue,l(s.course.comment.replace(/<\/br>/g,`
`)),1)):v("",!0)])])}}},me={class:"container"},fe={class:"grid-container"},ve={style:{display:"flex",gap:"0.5rem","flex-wrap":"wrap","justify-content":"center"}},Re={__name:"index",setup(s){J();const _=z(),{currentTerm:g,rowData:x,loading:b,defaultGlobalFilterFields:k,initTermData:d}=Y(),{selectedCourses:C,selectedRows:U,selectCourse:B,checkSelectedCourse:$,selectCodeHandler:O,checkSelectCode:M}=X(),E=m("updateMenubar");m("deptList");const H=m("isShowSchedule",()=>!1),L=m("isShowAdvancedSearch",()=>!1),G=m("subFilterRef",()=>null),h=m("scrollTableRef",()=>null);m("advancedSearchDisplayValue",()=>"點擊進行進階搜尋");const F=j(""),N=m("filters",()=>({global:{value:null,matchMode:K.CONTAINS},...Object.fromEntries(["option_code","course_name","chn_name","dept_chiabbr","eng_teach","generalCore","dept_code","time_inf","time_loc","timeListStr","comment","credit","programs"].map(f=>[f,{operator:Q.OR,constraints:[]}]))}));function w(f){var r;if(L.value||H.value||G.value&&G.value.overlayVisible)return 0;const t=(r=h.value)==null?void 0:r.$el.querySelector(".p-datatable-table-container");return t&&(t.scrollTop=Math.max(0,Math.min(t.scrollTop+f,t.scrollHeight-t.clientHeight)),t.scrollTop<t.scrollHeight-t.clientHeight&&t.scrollTop>0)?1:0}function P(){h.value&&h.value.d_first!==void 0&&(h.value.d_first=0)}return I(async()=>{const f=r=>{w(r.deltaY)&&r.preventDefault()},t=r=>{r.key==="Home"&&w(-1/0),r.key==="End"&&w(1/0)};window.addEventListener("wheel",f,{passive:!1}),window.addEventListener("keydown",t),q(()=>{window.removeEventListener("wheel",f),window.removeEventListener("keydown",t)}),await d(_),E.value(),C.value[g.value]||(C.value[g.value]={}),U.value=C.value[g.value]}),(f,t)=>(n(),y("div",me,[c(e(Z),{isSearchPage:!0,resetPage:P}),a("div",fe,[c(e(W),{ref_key:"scrollTableRef",ref:h,value:e(x),paginator:!0,filters:e(N),"global-filter-fields":F.value.filter_field||e(k),showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 22rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:e(b),style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"},onPage:t[0]||(t[0]=r=>w(-1/0))},{header:o(()=>t[1]||(t[1]=[a("span",null,"課程資訊",-1)])),loading:o(()=>[c(e(ee),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:o(()=>t[2]||(t[2]=[a("div",{class:"flex align-items-center justify-content-center"},[a("i",{class:"pi pi-exclamation-triangle mr-2"}),a("span",null,"沒有符合條件的課程")],-1)])),default:o(()=>[c(e(T),{sortable:!1},{body:o(({data:r})=>[c(e(de),{course:r},null,8,["course"])]),_:1}),c(e(T),{headerStyle:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center",paddingRight:"1rem"},header:""},{body:o(({data:r})=>[a("div",ve,[c(e(S),{icon:e(M)(r.course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(M)(r.course_code)?"danger":"secondary",variant:"text",onClick:D=>e(O)(r.course_code,r.course_name),rounded:""},null,8,["icon","severity","onClick"]),c(e(S),{label:e($)(r.serial_no)?"取消":"加入",severity:e($)(r.serial_no)?"warn":"secondary",onClick:D=>e(B)(r)},null,8,["label","severity","onClick"])])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])]))}};export{Re as default};
