import{D as i}from"./-6dXc0fm.js";function b(){const e=i("terms",()=>[]),t=i("currentTerm",()=>null),a=i("loadTermData"),s=i("rowDatas",()=>({})),c=i("rowData",()=>[]),l=i("tempDatas",()=>({})),u=i("loading",()=>!0),f=i("programSet",()=>new Set),m=["course_name","teacher","serial_no"],p=async n=>{const r=await fetch(`data/${t.value}/${n}.tsv`);if(!r.ok)return null;const o=await r.text(),d=S(o);return d.length===0?null:v(d)},L=async()=>{var r;const n=[];for(let o=0;o<=10;o++)(r=l.value[t.value])!=null&&r[o]?n.push(Promise.resolve(v(l.value[t.value][o]))):n.push(p(o));for await(const o of n)o&&(c.value=c.value.concat(o),u.value=!1)},h=async()=>{if(u.value=!0,s.value[t.value]){c.value=s.value[t.value],u.value=!1;return}c.value=[],await L(),s.value[t.value]=c.value},A=async n=>{if(e.value.length>0){u.value=!1;return}const o=await(await fetch("/data/terms.json")).json();e.value=o.terms,t.value=n==null?void 0:n.query.term,(!t.value||e.value.indexOf(t.value)===-1)&&(t.value=o.defaultValue),a.value=h,await h()},F=n=>{const r=w(n.time_inf),o=y(r);return{...n,credit:Math.round(n.credit*10)/10,course_name:n.chn_name.replace(/<\/br>.*/g,""),time_loc:r,time:_(r),location:D(r),timeLocList:o,teacher:g(n.teacher),timeListStr:T(o),programs:j(n.chn_name)}},v=n=>(n.forEach(r=>{r.credit=Math.round(r.credit*10)/10,r.course_name=r.chn_name.replace(/<\/br>.*/g,""),r.time_loc=w(r.time_inf),r.time=_(r.time_loc),r.location=D(r.time_loc),r.timeLocList=y(r.time_loc),r.teacher=g(r.teacher),r.timeListStr=T(r.timeLocList),r.programs=j(r.chn_name),r.programs&&r.programs.split("/").forEach(o=>{f.value.add(o)})}),n);return{terms:e,currentTerm:t,rowData:c,tempDatas:l,loading:u,programSet:f,reloadCurrentTerm:h,defaultGlobalFilterFields:m,initTermData:A,courseFormatter:F,tsvToJson:S}}function g(e){return e.replace("","温")}function _(e){return typeof e=="string"?e:Object.entries(e).map(([t,a])=>t).join("/")}function D(e){if(typeof e=="string")return null;const t=Object.values(e).filter(s=>s!==""),a=[...new Set(t)];return a.length===1?a[0]:t.join("/")}function w(e){return!e||e.startsWith("◎")?e:e.split(",").reduce((t,a)=>{const[s,c,...l]=a.trim().split(" ");return s&&c&&(t[`${s} ${c}`]=l.join(" ")),t},{})}function y(e){const t=[];if(typeof e!="object"||!e)return t;for(const a of Object.keys(e)){const s=a.match(/([一二三四五六])\s*(\d+|A|B|C|D)(?:-(\d+|A|B|C|D))?/);if(s){const[c,l,u,f]=s,m=x(u,f||u);for(const p of m)t.push({day:l,period:p,loc:e[a]})}}return t}function x(e,t){const a=["0","1","2","3","4","5","6","7","8","9","10","A","B","C","D"],s=a.indexOf(e),c=a.indexOf(t);return a.slice(s,c+1)}function T(e){return!Array.isArray(e)||e.length===0?"◎":e.map(({day:t,period:a})=>`${t}${a.replace("10","X")}`).join("/")}function j(e){const t=e.match(/.*\[ 學分學程：(.+?) \].*/);if(!t)return"";const a=t[1].split(" ");return a.length>0?a.join("/"):""}function S(e){const t=e.trim().split(`
`);if(t.length===0)return[];const a=t[0].trim().split("	");return t.slice(1).map(s=>{const c=s.trim().split("	"),l={};return a.forEach((u,f)=>{l[u]=c[f]??""}),l})}export{b as u};
