import{g as Y,t as b,v as n,x as c,y as d,z as r,A as s,B as h,E as e,K as V,H as O,I as y,F as L,G as z,C as A,r as x,L as m,o as Z,D as ee,M as le,N as ae,O as F,P as i,Q as te,R as se,S as j,T as D,U as oe}from"./Q0IBlKV6.js";import{u as re}from"./Dts0xD7e.js";import{u as ie}from"./CMmalUmr.js";import _ from"./C0LHB73b.js";import ce from"./BSnGeZQp.js";import ne from"./DJcR5vHE.js";import ue from"./B-ititZ1.js";import de from"./zuT7Pm9n.js";import me from"./B8kUSQKx.js";import ve from"./D4uh3tf4.js";import pe from"./DdCh7chG.js";import"./Dpn6uQT3.js";import"./DmJZ8Hnm.js";import"./dZdDEaMB.js";const fe={class:"course-row"},he={class:"course-cell course-code"},ge={class:"course-cell course-title"},be={class:"course-name"},_e={class:"message-group"},ye={class:"course-cell"},Ce={class:"message-group"},Oe={class:"course-cell course-comment"},ke={key:0},Ae={key:1},Se={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(t){const M={必:"必修",選:"選修",通:"通識"},k={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(w,$)=>{const N=Y("router-link");return n(),b("div",fe,[c("div",he,[c("span",null,d(t.course.serial_no),1),c("span",null,d(t.course.course_code),1)]),c("div",ge,[c("span",be,[r(e(V),{variant:"link",size:"large",asChild:""},{default:s(()=>[r(N,{to:{name:"course",query:{year:t.course.acadm_year,term:t.course.acadm_term,id:t.course.serial_no}}},{default:s(()=>[h(d(t.course.course_name),1)]),_:1},8,["to"])]),_:1})]),c("div",_e,[r(e(_),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(t.course.dept_chiabbr),1)]),_:1}),r(e(_),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(t.course.teacher),1)]),_:1}),t.course.time?(n(),O(e(_),{key:0,icon:"pi pi-clock",severity:t.course.time.match(/.* (0|1)([-/\n\r]|$)/)?"warn":"secondary",class:"custom-message"},{default:s(()=>[h(d(t.course.time),1)]),_:1},8,["severity"])):y("",!0),t.course.location?(n(),O(e(_),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(t.course.location),1)]),_:1})):y("",!0)])]),c("div",ye,[c("div",Ce,[r(e(_),{icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(M[t.course.option_code]||t.course.option_code),1)]),_:1}),t.course.generalCore?(n(!0),b(L,{key:0},z(t.course.generalCore.split("/"),S=>(n(),O(e(_),{key:S,icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(k[S]||S),1)]),_:2},1024))),128)):y("",!0),r(e(_),{icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:s(()=>[h(d(t.course.credit)+" 學分",1)]),_:1}),r(e(_),{icon:"pi pi-users",severity:t.course.limit_count_h>0?"secondary":"warn",class:"custom-message"},{default:s(()=>[h(d(`${t.course.limit_count_h} 人`),1)]),_:1},8,["severity"]),t.course.eng_teach==="是"?(n(),O(e(_),{key:1,severity:"error",class:"custom-message"},{default:s(()=>$[0]||($[0]=[h("英文授課")])),_:1})):y("",!0)])]),c("div",Oe,[t.course.restrict?(n(),b("span",ke,d(t.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):y("",!0),t.course.comment?(n(),b("span",Ae,d(t.course.comment.replace(/<\/br>/g,`
`)),1)):y("",!0)])])}}},we={class:"tabs-container"},$e={class:"container"},Me={class:"search-container search-bar"},Ne={key:0,class:"global-filter-label",for:"globalFilter"},Re={key:1,class:"global-filter-label advanced-search-label",for:"globalFilter"},Ue={key:0,class:"search-input multi-search-input-sub-filter"},Ge={key:1,class:"search-input multi-search-input-sub-filter"},Te={class:"grid-container"},xe={style:{display:"flex",gap:"0.5rem","flex-wrap":"wrap","justify-content":"center"}},Ve=null,Je={__name:"index",setup(t){const M=ae(),k=ee(),{currentTerm:w,rowData:$,loading:N,defaultGlobalFilterFields:S,initTermData:E}=re(),{selectedCourses:R,selectedRows:H,selectCourse:P,checkSelectedCourse:I,selectCodeHandler:Q,checkSelectCode:B}=ie(),K=A("updateMenubar"),W=A("deptList"),U=A("isShowAdvancedSearch",()=>!1),J=A("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),G=A("advancedSearchRebuildFunction"),v=x(""),o=x({value:null,filter_field:null,select_list:[],label:null}),p=A("filters",()=>({global:{value:Ve,matchMode:m.CONTAINS},option_code:{operator:i.OR,constraints:[]},course_name:{operator:i.OR,constraints:[]},chn_name:{operator:i.OR,constraints:[]},dept_chiabbr:{operator:i.OR,constraints:[]},eng_teach:{operator:i.OR,constraints:[]},generalCore:{operator:i.OR,constraints:[]},dept_code:{operator:i.OR,constraints:[]},time_inf:{operator:i.OR,constraints:[]},time_loc:{operator:i.OR,constraints:[]},timeListStr:{operator:i.OR,constraints:[]},comment:{operator:i.OR,constraints:[]},credit:{operator:i.OR,constraints:[]}})),T=x({quick:{label:"快速搜尋",value:"quick",command:()=>f({})},dept:{label:"系所",value:"dept",command:()=>f({dept_chiabbr:{operator:i.OR,constraints:[{value:null,matchMode:m.CONTAINS}]}},{label:"選擇開課單位",grouped_select_list:W.value||{},filter_field:"dept_code"})},advanced:{label:"進階搜尋",value:"advanced",command:()=>{U.value=!0,f({}),p.value.global.value=null,G&&G.value&&G.value()}},general:{label:"通識",value:"general",command:()=>f({option_code:{operator:i.OR,constraints:[{value:"通",matchMode:m.EQUALS}]}},{label:"選擇通識領域",select_list:Object.entries({人文藝術:"A1UG",社會科學:"A2UG",自然科學:"A3UG",邏輯運算:"A4UG",學院共同課程:"B1UG",跨域專業探索課程:"B2UG",大學入門:"B3UG",專題探究:"C1UG",MOOCs:"C2UG"}).map(([u,l])=>({label:u,value:{value:l,matchMode:m.CONTAINS}})),filter_field:"generalCore"})},physical:{label:"體育",activeLabel:"普通體育",value:"physical",command:()=>f({dept_chiabbr:{operator:i.OR,constraints:[{value:"體育",matchMode:m.CONTAINS}]}})},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",command:()=>f({chn_name:{operator:i.OR,constraints:[{value:"全民國防",matchMode:m.CONTAINS}]}})},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",command:()=>f({dept_chiabbr:{operator:i.OR,constraints:[{value:"校際",matchMode:m.CONTAINS}]}},{label:"選擇開課學校",select_list:Object.entries({國立臺灣大學:"AA",國立臺灣科技大學:"AB"}).map(([u,l])=>({label:u,value:{value:l,matchMode:m.ENDS_WITH}})),filter_field:"dept_code"})},program:{label:"學分學程",value:"program",command:()=>f({chn_name:{operator:i.OR,constraints:[{value:"學分學程",matchMode:m.CONTAINS}]}})},english:{label:"英文三",value:"english",command:()=>f({course_name:{operator:i.OR,constraints:[{value:"英文（三）",matchMode:m.CONTAINS}]}})},emi:{label:"英文授課",value:"emi",command:()=>f({eng_teach:{operator:i.OR,constraints:[{value:"是",matchMode:m.EQUALS}]}})},"":{label:"",value:"quick",command:()=>f({})}});Z(async()=>{var u,l;await E(k),K.value(),v.value=((u=k.query.m)==null?void 0:u.toLowerCase())||"quick",T.value[v.value]?(l=T.value[v.value])==null||l.command():v.value="quick",R.value[w.value]||(R.value[w.value]={}),H.value=R.value[w.value]}),le(()=>v.value,u=>{M.replace({path:k.path,query:{...k.query,m:u,s:p.value.global.value||null}})});function f(u,l=null){var a;for(const g in p.value)g!=="global"&&(g in u?p.value[g]=u[g]:(a=p.value[g]).constraints&&(a.constraints=[]));l?o.value={...o.value,value:null,filter_field:l.filter_field,select_list:l.select_list||null,grouped_select_list:l.grouped_select_list||null,label:l.label}:(o.value.select_list=null,o.value.grouped_select_list=null)}function q(){U.value=!0}function X(){const u=o.value.value;if(!u||Object.keys(u).length===0){p.value[o.value.filter_field].constraints=[{value:null,matchMode:m.CONTAINS}];return}const l=o.value.grouped_select_list;p.value[o.value.filter_field].constraints=Object.entries(u).map(([a,g])=>{if(!g.checked)return{value:null,matchMode:m.CONTAINS};const C=a.split("-");return C.length===1?l[a].data:C.length===2?l[C[0]].children[C[1]].data:l[C[0]].children[C[1]].children[C[2]].data})}return(u,l)=>(n(),b(L,null,[c("div",we,[r(e(ue),{value:v.value,"onUpdate:value":l[0]||(l[0]=a=>v.value=a),scrollable:""},{default:s(()=>[r(e(ce),null,{default:s(()=>[(n(!0),b(L,null,z(Object.values(T.value),a=>(n(),O(e(ne),{key:a.value,value:a.value,onClick:g=>a.command?a.command():null,class:F(a.label?"":"tab-disabled")},{default:s(()=>[h(d(v.value==a.value&&a.activeLabel||a.label),1)]),_:2},1032,["value","onClick","class"]))),128))]),_:1})]),_:1},8,["value"])]),c("div",$e,[c("div",Me,[r(e(de),{variant:"in",class:F(["search-input",o.value.select_list||o.value.grouped_select_list?"multi-search-input-main-filter":"single-search-input"]),onClick:l[2]||(l[2]=a=>e(U)?q():null)},{default:s(()=>[r(e(te),null,{default:s(()=>[r(e(se),null,{default:s(()=>l[7]||(l[7]=[c("i",{class:"pi pi-search"},null,-1)])),_:1}),v.value!="advanced"?(n(),O(e(j),{key:0,id:"globalFilter",modelValue:e(p).global.value,"onUpdate:modelValue":l[1]||(l[1]=a=>e(p).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"}},null,8,["modelValue"])):(n(),O(e(j),{key:1,id:"globalFilter",value:"",readonly:"",autocapitalize:!1,size:"large",style:{width:"100%",cursor:"pointer"},onClick:q}))]),_:1}),v.value!="advanced"?(n(),b("label",Ne,"課程名稱/教師/開課序號")):(n(),b("label",Re,d(e(J)||"點擊進行進階搜尋"),1))]),_:1},8,["class"]),o.value.select_list?(n(),b("div",Ue,[r(e(me),{id:"sub-filter",modelValue:o.value.value,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.value=a),options:o.value.select_list,optionLabel:"label",optionValue:"value",showClear:!0,showToggleAll:!1,showFilter:!0,placeholder:o.value.label,display:"chip",style:{width:"100%"},onChange:l[4]||(l[4]=a=>{e(p)[o.value.filter_field].constraints=a.value||[{value:null,matchMode:e(m).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):y("",!0),o.value.grouped_select_list?(n(),b("div",Ge,[r(e(ve),{id:"sub-filter-grouped",modelValue:o.value.value,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.value=a),options:o.value.grouped_select_list,selectionMode:"checkbox",filter:"",filterMode:"lenient",showClear:!0,placeholder:o.value.label,style:{width:"100%"},onChange:l[6]||(l[6]=a=>X())},null,8,["modelValue","options","placeholder"])])):y("",!0)]),c("div",Te,[r(e(oe),{value:e($),paginator:!0,filters:e(p),"global-filter-fields":v.value.filter_field||e(S),showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 22rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:e(N),style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"}},{header:s(()=>l[8]||(l[8]=[c("span",null,"課程資訊",-1)])),loading:s(()=>[r(e(pe),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:s(()=>l[9]||(l[9]=[c("div",{class:"flex align-items-center justify-content-center"},[c("i",{class:"pi pi-exclamation-triangle mr-2"}),c("span",null,"沒有符合條件的課程")],-1)])),default:s(()=>[r(e(D),{sortable:!1},{body:s(({data:a})=>[r(e(Se),{course:a},null,8,["course"])]),_:1}),r(e(D),{headerStyle:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center",paddingRight:"1rem"},header:""},{body:s(({data:a})=>[c("div",xe,[r(e(V),{icon:e(B)(a.course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(B)(a.course_code)?"danger":"secondary",variant:"text",onClick:g=>e(Q)(a.course_code,a.course_name),rounded:""},null,8,["icon","severity","onClick"]),r(e(V),{label:e(I)(a.serial_no)?"取消":"加入",severity:e(I)(a.serial_no)?"warn":"secondary",onClick:g=>e(P)(a)},null,8,["label","severity","onClick"])])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])])],64))}};export{Je as default};
