import{_ as q,T as F,r as x,D as V,o as R,v as n,H as e,y as l,A as c,G as J,J as m,$ as K,z as d,B as u,a0 as P,K as _,I as Q,a1 as X,x as i,L as z,M as S,N as D,a2 as T,a3 as w,a4 as b,U as B,a5 as $,C as M}from"./BQzQASQ-.js";import{u as Y,a as Z}from"./ZhCaDUt0.js";import ee from"./CpSLPjeR.js";const te={class:"course-details-container"},ae={key:0,class:"course-details"},se={class:"course-details-subtitle"},oe={class:"course-details-subtitle-right"},le={class:"course-info-first"},re={class:"course-info-item"},ie={style:{flex:"1",display:"flex","flex-direction":"column"}},ne={style:{color:"var(--p-surface-500)","font-size":"12px"}},ce={style:{"font-size":"1.25rem"}},ue={style:{flex:"1",display:"flex","flex-direction":"column"}},de={style:{color:"var(--p-surface-500)","font-size":"12px"}},pe={style:{"font-size":"1.25rem"}},me={key:0,class:"course-info-item"},fe={style:{"font-size":"1.1rem"}},_e={key:1,class:"course-info-item"},ve={style:{"font-size":"1.1rem"}},ye={key:2,class:"course-info-item"},he={style:{display:"flex",flexDirection:"row",gap:"clamp(0.5rem, 3vw - 0.5rem, 2rem)"}},ge={style:{minWidth:"20%"}},xe={style:{fontSize:"clamp(1rem, 2vw + 0.25rem, 1.2rem)",marginBottom:"0.5rem"}},we={class:"course-info-item",style:{fontSize:"1.2rem",fontFamily:"sans-serif",alignItems:"flex-end",gap:"0.2rem"}},be={key:0,style:{fontSize:"1.75rem",fontWeight:"900"}},$e={key:1},ke={key:0,class:"course-info-item",style:{"flex-direction":"column","align-items":"flex-start"}},Ce=["innerHTML"],ze=["src","width","height"],Se={key:1,class:"course-details"},De={__name:"course",setup(Me){const v=F(),{tempDatas:f,initTermData:I,courseFormatter:N}=Y(),{windowWidth:p,selectCourseWithTerm:A,checkSelectedCourse:G,selectCodeHandler:L,checkSelectCode:U}=Z(),t=x({year:v.query.year,term:v.query.term,serial_no:v.query.id}),k=x(!1),y=x(!1),h=x([]),W={必:"必修",選:"選修",通:"通識"},E={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};t.value.year&&t.value.term&&t.value.serial_no?H():console.error("Missing course parameters",{year:t.value.year,term:t.value.term,serial_no:t.value.serial_no});function H(){const a=V("rowDatas",()=>({})),s=`${t.value.year}-${t.value.term}`;function r(){Q({title:`${s} ${t.value.course_name}`}),setTimeout(()=>{j(t.value.course_code).then(o=>{t.value.description=o,X({meta:[{name:"description",content:o?o.brief||o.description:""}]})})})}if(a.value[s]){for(const o of a.value[s])if(o.serial_no===t.value.serial_no){t.value={...o,description:null},h.value=C(t.value),r();return}}if(f.value[s]&&f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]){for(const o of f.value[s][Math.floor(t.value.serial_no/1e3)+1])if(o.serial_no===t.value.serial_no){t.value={...N(o),description:null},h.value=C(t.value),r();return}}fetch(`data/${s}/${(Math.floor(t.value.serial_no/1e3)+1)%10}.min.json`).then(o=>o.json()).then(async o=>{f.value[s]=f.value[s]||{},f.value[s][(Math.floor(t.value.serial_no/1e3)+1)%10]=o;for(const g of o)if(g.serial_no===t.value.serial_no){t.value={...N(g),description:null},h.value=C(t.value),r();return}console.error("Course not found in fetched data")}).catch(o=>{console.error("Error fetching course data:",o)})}async function j(a){return await fetch("https://cors.ntnux.org/?course_code="+a).then(async r=>{const o=await r.json();return o&&o.data&&o.data.length>0?{description:o.data[0].CourseDescription||"",brief:o.data[0].brief||""}:(console.error("Description not found in response",o),"No description available.")}).catch(r=>(console.error("Error fetching course description:",r),"Error fetching description."))}function C(a){return[{label:"開課序號",icon:"pi pi-hashtag",value:a.serial_no},{label:"科目代碼",icon:"pi pi-code",value:a.course_code},{label:"開課單位",icon:"pi pi-building",value:a.dept_chiabbr},{icon:"pi pi-objects-column",value:W[a.option_code]||a.option_code,childen:a.generalCore?a.generalCore.split("/").map(s=>E[s]||s):[]},{icon:"pi pi-graduation-cap",value:`${a.credit} 學分`,isNullValue:!a.credit},{label:"授課教師",icon:"pi pi-user",value:a.teacher||"無",isNullValue:!a.teacher},{label:"上課時間",icon:"pi pi-clock",value:a.time||"無",isNullValue:!a.time},{label:"上課地點",icon:"pi pi-map-marker",value:a.location||"無",isNullValue:!a.location},{icon:"pi pi-language",value:a.eng_teach==="是"?"英文授課":a.comment.match(/◎*語\s*授課/)?"國家語言授課":"中文授課"},{label:typeof a.programs=="string"&&a.programs.split("/").length>1?"學分學程":"",icon:"pi pi-book",value:typeof a.programs!="string"||a.programs===""?"無學分學程":a.programs.split("/").length>1?`${a.programs.split("/").length} 個學分學程`:a.programs,isNullValue:typeof a.programs!="string"||a.programs==="",childen:typeof a.programs=="string"&&a.programs.split("/").length>1?a.programs.split("/"):[]}]}function O(){y.value=!0,setTimeout(()=>{y.value=!1,k.value=!0},500)}return R(async()=>{const a=V("updateMenubar");await I(v),a.value()}),(a,s)=>(i(),n("div",te,[e(t).course_name?(i(),n("div",ae,[l("h1",null,d(e(t).course_name),1),l("div",se,[l("p",null,d(e(t).acadm_year)+"-"+d(e(t).acadm_term)+" 開課",1),l("div",oe,[c(e(z),{icon:e(U)(e(t).course_code)?"pi pi-heart-fill":"pi pi-heart",severity:e(U)(e(t).course_code)?"danger":"secondary",variant:"text",onClick:s[0]||(s[0]=r=>e(L)(e(t).course_code,e(t).course_name)),rounded:""},null,8,["icon","severity"]),c(e(z),{label:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"取消":"加入",severity:e(G)(e(t).serial_no,`${e(t).acadm_year}-${e(t).acadm_term}`)?"warn":"secondary",onClick:s[1]||(s[1]=r=>e(A)(e(t),`${e(t).acadm_year}-${e(t).acadm_term}`))},null,8,["label","severity"])])]),c(e(ee),{class:"course-card"},{content:u(()=>[l("div",le,[(i(!0),n(S,null,D(e(h),r=>(i(),n("div",{key:r.label},[r.childen&&r.childen.length>0?(i(),n("div",{key:0,class:"course-info-item",style:_({color:r.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[c(e(T),{value:"1",style:{width:"100%"}},{default:u(()=>[c(e(w),{value:"1",style:{width:"100%",border:"0"}},{default:u(()=>[c(e(b),{style:{padding:"0",width:"100%"}},{default:u(()=>[l("div",re,[l("i",{class:B(r.icon),style:{"font-size":"1.2rem"}},null,2),l("div",ie,[l("span",ne,d(r.label),1),l("span",ce,d(r.value||""),1)])])]),_:2},1024),c(e($),{style:{"--p-accordion-content-padding":"0 1.25rem"}},{default:u(()=>[(i(!0),n(S,null,D(r.childen,o=>(i(),n("div",{key:o,style:{margin:"0.5rem 0",fontSize:"1.1rem"}},[l("span",null,d(o),1)]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)],4)):(i(),n("div",{key:1,class:"course-info-item",style:_({color:r.isNullValue?"var(--p-surface-400)":"var(--p-text)"})},[l("i",{class:B(r.icon),style:{"font-size":"1.2rem"}},null,2),l("div",ue,[l("span",de,d(r.label),1),l("span",pe,d(r.value||""),1)])],4))]))),128))]),l("div",{class:"course-info-second",style:_(e(p)<600?{"--p-accordion-content-padding":"0 0 1.125rem 0"}:{})},[c(e(T),{multiple:"",value:["1","2","3"]},{default:u(()=>[c(e(w),{value:"1"},{default:u(()=>[c(e(b),{style:{fontSize:"1.25rem"}},{default:u(()=>s[2]||(s[2]=[M(" 備註/限修 ")])),_:1}),c(e($),null,{default:u(()=>[e(t).comment?(i(),n("div",me,[s[3]||(s[3]=l("i",{class:"pi pi-comment",style:{"font-size":"1.2rem"}},null,-1)),l("span",fe,d(e(t).comment),1)])):m("",!0),e(t).restrict?(i(),n("div",_e,[s[4]||(s[4]=l("i",{class:"pi pi-exclamation-triangle",style:{"font-size":"1.2rem"}},null,-1)),l("span",ve,d(e(t).restrict),1)])):m("",!0),!e(t).comment&&!e(t).restrict?(i(),n("div",ye,s[5]||(s[5]=[l("span",{style:{"font-size":"1.1rem",color:"var(--p-surface-500)"}},"無",-1)]))):m("",!0)]),_:1})]),_:1}),c(e(w),{value:"2"},{default:u(()=>[c(e(b),{style:{fontSize:"1.25rem"}},{default:u(()=>s[6]||(s[6]=[M(" 選課資訊 ")])),_:1}),c(e($),null,{default:u(()=>[l("div",he,[(i(!0),n(S,null,D([["選課總人數",e(t).counter_exceptAuth,e(t).limit_count_h],["已使用授權碼",e(t).counter-e(t).counter_exceptAuth,e(t).authorize_p],["系統各校開放名額",null,e(t).limit]],([r,o,g])=>(i(),n("div",ge,[l("div",xe,[l("span",null,d(r),1)]),l("div",we,[o!==null?(i(),n("div",be,d(o),1)):m("",!0),o!==null?(i(),n("div",$e,"/")):m("",!0),l("div",{style:_({fontSize:o!==null?"1.2rem":"1.75rem",fontWeight:o!==null?"400":"900"})},d(g),5)])]))),256))])]),_:1})]),_:1}),c(e(w),{value:"3"},{default:u(()=>[c(e(b),{style:{fontSize:"1.25rem"}},{default:u(()=>s[7]||(s[7]=[M(" 課程簡介 ")])),_:1}),c(e($),null,{default:u(()=>[e(t).description?(i(),n("div",ke,[l("span",{innerHTML:e(t).description.brief||e(t).description.description,style:{"font-size":"1.1rem","white-space":"pre-wrap","text-indent":"2em"}},null,8,Ce)])):m("",!0)]),_:1})]),_:1})]),_:1})],4)]),_:1}),!e(k)||e(y)?(i(),J(e(z),{key:0,label:"顯示課程大綱",icon:"pi pi-file",severity:"contrast",variant:"outlined",onClick:O,loading:e(y),style:{marginTop:"20px",width:"100%"}},null,8,["loading"])):m("",!0),K(l("div",{style:_({height:e(p)<950?(e(p)-10)/950*2e3+"px":"800px",overflow:"hidden",maxWidth:"95vw"})},[l("iframe",{src:`https://courseap2.itc.ntnu.edu.tw/acadmOpenCourse/SyllabusCtrl?year=${e(t).acadm_year}&term=${e(t).acadm_term}&courseCode=${e(t).course_code}&courseGroup=${e(t).course_group}&deptCode=${e(t).dept_code}&formS=${e(t).form_s}&classes1=${e(t).classes}&deptGroup=${e(t).dept_group_name}`,width:e(p)<950?"950px":"100%",height:e(p)<950?"2000px":"800px",frameborder:"0",style:_({marginTop:"20px",background:"#fff","-webkit-transform":`scale(${e(p)<950?(e(p)-10)/950:1})`,"-moz-transform":`scale(${e(p)<950?(e(p)-10)/950:1})`,transformOrigin:"top left",marginLeft:"auto",marginRight:"auto"})},null,12,ze)],4),[[P,e(k)]])])):(i(),n("div",Se,s[8]||(s[8]=[l("h2",null,"Loading course details...",-1)])))]))}},Ve=q(De,[["__scopeId","data-v-1d7d6e13"]]);export{Ve as default};
