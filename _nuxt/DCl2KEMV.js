import{g as ee,t as y,v as u,x as i,y as d,z as r,A as s,B as b,E as t,O as V,F as O,I as k,G as I,H as z,C as w,r as R,P as v,o as le,e as te,D as ae,Q as se,R as oe,S as D,T as n,J as re,K as ne,L as H,U as j,V as ie}from"./Q2KG5fdx.js";import{u as ce}from"./RQcqIEXU.js";import{u as ue}from"./BBP596We.js";import _ from"./geR-tA6I.js";import de from"./CRhXsxIJ.js";import ve from"./BmNxosb9.js";import me from"./Dl0VzYq3.js";import pe from"./O5H2VLHY.js";import fe from"./RA_48FP0.js";import he from"./CUA0XSux.js";import ge from"./DKsQF-xH.js";import"./VXbGxlIs.js";import"./AzgP3zSy.js";import"./77DSX_AB.js";const be={class:"course-row"},ye={class:"course-cell course-code"},_e={class:"course-cell course-title"},Ce={class:"course-name"},ke={class:"message-group"},Oe={class:"course-cell"},we={class:"message-group"},Se={class:"course-cell course-comment"},Ae={key:0},$e={key:1},Me={__name:"courseCell",props:{course:{type:Object,required:!0}},setup(a){const N={必:"必修",選:"選修",通:"通識"},C={A1UG:"人文藝術",A2UG:"社會科學",A3UG:"自然科學",A4UG:"邏輯運算",B1UG:"學院共同課程",B2UG:"跨域專業探索課程",B3UG:"大學入門",C1UG:"專題探究",C2UG:"MOOCs"};return(A,$)=>{const U=ee("router-link");return u(),y("div",be,[i("div",ye,[i("span",null,d(a.course.serial_no),1),i("span",null,d(a.course.course_code),1)]),i("div",_e,[i("span",Ce,[r(t(V),{variant:"link",size:"large",asChild:""},{default:s(()=>[r(U,{to:{name:"course",query:{year:a.course.acadm_year,term:a.course.acadm_term,id:a.course.serial_no}}},{default:s(()=>[b(d(a.course.course_name),1)]),_:1},8,["to"])]),_:1})]),i("div",ke,[r(t(_),{icon:"pi pi-building",severity:"secondary",class:"custom-message"},{default:s(()=>[b(d(a.course.dept_chiabbr),1)]),_:1}),r(t(_),{icon:"pi pi-user",severity:"secondary",class:"custom-message"},{default:s(()=>[b(d(a.course.teacher),1)]),_:1}),a.course.time?(u(),O(t(_),{key:0,icon:"pi pi-clock",severity:a.course.time.match(/.* (0|1)([-/\n\r]|$)/)?"warn":"secondary",class:"custom-message"},{default:s(()=>[b(d(a.course.time),1)]),_:1},8,["severity"])):k("",!0),a.course.location?(u(),O(t(_),{key:1,icon:"pi pi-map-marker",severity:"secondary",class:"custom-message"},{default:s(()=>[b(d(a.course.location),1)]),_:1})):k("",!0)])]),i("div",Oe,[i("div",we,[r(t(_),{icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:s(()=>[b(d(N[a.course.option_code]||a.course.option_code),1)]),_:1}),a.course.generalCore?(u(!0),y(I,{key:0},z(a.course.generalCore.split("/"),S=>(u(),O(t(_),{key:S,icon:"pi pi-tag",severity:"secondary",class:"custom-message"},{default:s(()=>[b(d(C[S]||S),1)]),_:2},1024))),128)):k("",!0),r(t(_),{icon:"pi pi-book",severity:"secondary",class:"custom-message"},{default:s(()=>[b(d(a.course.credit)+" 學分",1)]),_:1}),r(t(_),{icon:"pi pi-users",severity:a.course.limit_count_h>0?"secondary":"warn",class:"custom-message"},{default:s(()=>[b(d(`${a.course.limit_count_h} 人`),1)]),_:1},8,["severity"]),a.course.eng_teach==="是"?(u(),O(t(_),{key:1,severity:"error",class:"custom-message"},{default:s(()=>$[0]||($[0]=[b("英文授課")])),_:1})):k("",!0)])]),i("div",Se,[a.course.restrict?(u(),y("span",Ae,d(a.course.restrict.replace(/<\/br>/g,`
`).replace(new RegExp("(?<=.)◎","g"),`
◎`)),1)):k("",!0),a.course.comment?(u(),y("span",$e,d(a.course.comment.replace(/<\/br>/g,`
`)),1)):k("",!0)])])}}},Re={class:"tabs-container"},Ne={class:"container"},Ue={class:"search-container search-bar"},Te={key:0,class:"global-filter-label",for:"globalFilter"},Ge={key:1,class:"global-filter-label advanced-search-label",for:"globalFilter"},xe={key:0,class:"search-input multi-search-input-sub-filter"},Le={key:1,class:"search-input multi-search-input-sub-filter"},Ve={class:"grid-container"},Ie={style:{display:"flex",gap:"0.5rem","flex-wrap":"wrap","justify-content":"center"}},qe=null,Ze={__name:"index",setup(a){const N=oe(),C=ae(),{currentTerm:A,rowData:$,loading:U,defaultGlobalFilterFields:S,initTermData:P}=ce(),{selectedCourses:T,selectedRows:Q,selectCourse:K,checkSelectedCourse:q,selectCodeHandler:W,checkSelectCode:B}=ue(),J=w("updateMenubar"),Y=w("deptList"),G=w("isShowAdvancedSearch",()=>!1),X=w("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),E=R(null),x=w("advancedSearchRebuildFunction"),h=R(""),o=R({value:null,filter_field:null,select_list:null,grouped_select_list:null,label:null}),m=w("filters",()=>({global:{value:qe,matchMode:v.CONTAINS},option_code:{operator:n.OR,constraints:[]},course_name:{operator:n.OR,constraints:[]},chn_name:{operator:n.OR,constraints:[]},dept_chiabbr:{operator:n.OR,constraints:[]},eng_teach:{operator:n.OR,constraints:[]},generalCore:{operator:n.OR,constraints:[]},dept_code:{operator:n.OR,constraints:[]},time_inf:{operator:n.OR,constraints:[]},time_loc:{operator:n.OR,constraints:[]},timeListStr:{operator:n.OR,constraints:[]},comment:{operator:n.OR,constraints:[]},credit:{operator:n.OR,constraints:[]}})),L=R({quick:{label:"快速搜尋",value:"quick",command:()=>g({})},dept:{label:"系所",value:"dept",command:()=>g({dept_chiabbr:{operator:n.OR,constraints:[{value:null,matchMode:v.CONTAINS}]}},{label:"選擇開課單位",grouped_select_list:Y.value||{},filter_field:"dept_code"})},advanced:{label:"進階搜尋",value:"advanced",command:()=>{G.value=!0,g({}),m.value.global.value=null,x&&x.value&&x.value()}},general:{label:"通識",value:"general",command:()=>g({option_code:{operator:n.OR,constraints:[{value:"通",matchMode:v.EQUALS}]}},{label:"選擇通識領域",select_list:Object.entries({人文藝術:"A1UG",社會科學:"A2UG",自然科學:"A3UG",邏輯運算:"A4UG",學院共同課程:"B1UG",跨域專業探索課程:"B2UG",大學入門:"B3UG",專題探究:"C1UG",MOOCs:"C2UG"}).map(([c,e])=>({label:c,value:{value:e,matchMode:v.CONTAINS}})),filter_field:"generalCore"})},physical:{label:"體育",activeLabel:"普通體育",value:"physical",command:()=>g({dept_chiabbr:{operator:n.OR,constraints:[{value:"體育",matchMode:v.CONTAINS}]}})},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",command:()=>g({chn_name:{operator:n.OR,constraints:[{value:"全民國防",matchMode:v.CONTAINS}]}})},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",command:()=>g({dept_chiabbr:{operator:n.OR,constraints:[{value:"校際",matchMode:v.CONTAINS}]}},{label:"選擇開課學校",select_list:Object.entries({國立臺灣大學:"AA",國立臺灣科技大學:"AB"}).map(([c,e])=>({label:c,value:{value:e,matchMode:v.ENDS_WITH}})),filter_field:"dept_code"})},program:{label:"學分學程",value:"program",command:()=>g({chn_name:{operator:n.OR,constraints:[{value:"學分學程",matchMode:v.CONTAINS}]}})},english:{label:"英文三",value:"english",command:()=>g({course_name:{operator:n.OR,constraints:[{value:"英文（三）",matchMode:v.CONTAINS}]}})},emi:{label:"英文授課",value:"emi",command:()=>g({eng_teach:{operator:n.OR,constraints:[{value:"是",matchMode:v.EQUALS}]}})},"":{label:"",value:"quick",command:()=>g({})}});function M(c){var l;const e=(l=E.value)==null?void 0:l.$el.querySelector(".p-datatable-table-container");return e&&(e.scrollTop=Math.max(0,Math.min(e.scrollTop+c,e.scrollHeight-e.clientHeight)),e.scrollTop<e.scrollHeight-e.clientHeight&&e.scrollTop>0)?1:0}le(async()=>{var l,p;const c=f=>{M(f.deltaY)&&f.preventDefault()},e=f=>{f.key==="Home"&&M(-1/0),f.key==="End"&&M(1/0)};window.addEventListener("wheel",c,{passive:!1}),window.addEventListener("keydown",e),te(()=>{window.removeEventListener("wheel",c),window.removeEventListener("keydown",e)}),await P(C),J.value(),h.value=((l=C.query.m)==null?void 0:l.toLowerCase())||"quick",C.query.s?m.value.global.value=C.query.s:m.value.global.value=null,L.value[h.value]?(p=L.value[h.value])==null||p.command():h.value="quick",T.value[A.value]||(T.value[A.value]={}),Q.value=T.value[A.value]}),se(()=>h.value,c=>{N.replace({path:C.path,query:{...C.query,m:c,s:m.value.global.value||null}})});function g(c,e=null){var l;for(const p in m.value)p!=="global"&&(p in c?m.value[p]=c[p]:(l=m.value[p]).constraints&&(l.constraints=[]));e?o.value={...o.value,value:null,filter_field:e.filter_field,select_list:e.select_list||null,grouped_select_list:e.grouped_select_list||null,label:e.label}:(o.value.select_list=null,o.value.grouped_select_list=null)}function F(){G.value=!0}function Z(){const c=o.value.value;if(!c||Object.keys(c).length===0){m.value[o.value.filter_field].constraints=[{value:null,matchMode:v.CONTAINS}];return}const e=o.value.grouped_select_list;m.value[o.value.filter_field].constraints=Object.entries(c).map(([l,p])=>{if(!p.checked)return{value:null,matchMode:v.CONTAINS};const f=l.split("-");return f.length===1?e[l].data:f.length===2?e[f[0]].children[f[1]].data:e[f[0]].children[f[1]].children[f[2]].data})}return(c,e)=>(u(),y(I,null,[i("div",Re,[r(t(me),{value:h.value,"onUpdate:value":e[0]||(e[0]=l=>h.value=l),scrollable:""},{default:s(()=>[r(t(de),null,{default:s(()=>[(u(!0),y(I,null,z(Object.values(L.value),l=>(u(),O(t(ve),{key:l.value,value:l.value,onClick:p=>l.command?l.command():null,class:D(l.label?"":"tab-disabled")},{default:s(()=>[b(d(h.value==l.value&&l.activeLabel||l.label),1)]),_:2},1032,["value","onClick","class"]))),128))]),_:1})]),_:1},8,["value"])]),i("div",Ne,[i("div",Ue,[r(t(pe),{variant:"in",class:D(["search-input",o.value.select_list||o.value.grouped_select_list?"multi-search-input-main-filter":"single-search-input"]),onClick:e[2]||(e[2]=l=>t(G)?F():null)},{default:s(()=>[r(t(re),null,{default:s(()=>[r(t(ne),null,{default:s(()=>e[8]||(e[8]=[i("i",{class:"pi pi-search"},null,-1)])),_:1}),h.value!="advanced"?(u(),O(t(H),{key:0,id:"globalFilter",modelValue:t(m).global.value,"onUpdate:modelValue":e[1]||(e[1]=l=>t(m).global.value=l),autocapitalize:!1,size:"large",style:{width:"100%"}},null,8,["modelValue"])):(u(),O(t(H),{key:1,id:"globalFilter",value:"",readonly:"",autocapitalize:!1,size:"large",style:{width:"100%",cursor:"pointer"},onClick:F}))]),_:1}),h.value!="advanced"?(u(),y("label",Te,"課程名稱/教師/開課序號")):(u(),y("label",Ge,d(t(X)||"點擊進行進階搜尋"),1))]),_:1},8,["class"]),o.value.select_list?(u(),y("div",xe,[r(t(fe),{id:"sub-filter",modelValue:o.value.value,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.value=l),options:o.value.select_list,optionLabel:"label",optionValue:"value",showClear:!0,showToggleAll:!1,showFilter:!0,placeholder:o.value.label,display:"chip",style:{width:"100%"},onChange:e[4]||(e[4]=l=>{t(m)[o.value.filter_field].constraints=l.value||[{value:null,matchMode:t(v).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):k("",!0),o.value.grouped_select_list?(u(),y("div",Le,[r(t(he),{id:"sub-filter-grouped",modelValue:o.value.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.value=l),options:o.value.grouped_select_list,selectionMode:"checkbox",filter:"",filterMode:"lenient",showClear:!0,placeholder:o.value.label,style:{width:"100%"},onChange:e[6]||(e[6]=l=>Z())},null,8,["modelValue","options","placeholder"])])):k("",!0)]),i("div",Ve,[r(t(ie),{ref_key:"scrollTableRef",ref:E,value:t($),paginator:!0,filters:t(m),"global-filter-fields":h.value.filter_field||t(S),showGridlines:!1,"show-headers":!1,scrollable:!0,scrollHeight:"calc(100vh - 22rem)",rows:50,rowsPerPageOptions:[10,20,50,100],loading:t(U),style:{border:"1px solid var(--p-datatable-border-color)",borderRadius:"0.5rem"},onPage:e[7]||(e[7]=l=>M(-1/0))},{header:s(()=>e[9]||(e[9]=[i("span",null,"課程資訊",-1)])),loading:s(()=>[r(t(ge),{width:"100%",height:"100%",shape:"rectangle","border-radius":"0.5rem"})]),empty:s(()=>e[10]||(e[10]=[i("div",{class:"flex align-items-center justify-content-center"},[i("i",{class:"pi pi-exclamation-triangle mr-2"}),i("span",null,"沒有符合條件的課程")],-1)])),default:s(()=>[r(t(j),{sortable:!1},{body:s(({data:l})=>[r(t(Me),{course:l},null,8,["course"])]),_:1}),r(t(j),{headerStyle:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center"},bodyStyle:{textAlign:"center"},sortable:!1,style:{width:"clamp(5rem, 10vw, 10rem)",textAlign:"center",paddingRight:"1rem"},header:""},{body:s(({data:l})=>[i("div",Ie,[r(t(V),{icon:t(B)(l.course_code)?"pi pi-heart-fill":"pi pi-heart",severity:t(B)(l.course_code)?"danger":"secondary",variant:"text",onClick:p=>t(W)(l.course_code,l.course_name),rounded:""},null,8,["icon","severity","onClick"]),r(t(V),{label:t(q)(l.serial_no)?"取消":"加入",severity:t(q)(l.serial_no)?"warn":"secondary",onClick:p=>t(K)(l)},null,8,["label","severity","onClick"])])]),_:1})]),_:1},8,["value","filters","global-filter-fields","loading"])])])],64))}};export{Ze as default};
