import{u as x,T as j,D as v,P as r,Q as p,r as M,I as D,o as E,F as K,v as g,x as m,y as A,A as h,B as S,H as l,U as R,M as U,N as H,G as y,V as W,C as J,z as $,W as X,J as P,X as Y,Y as Z,Z as V,$ as I}from"./Dt7xPlWn.js";import{u as Q}from"./BCJsK1af.js";import{u as ee}from"./DCORhbU6.js";import le from"./BNYfMsHz.js";import ae from"./Dw0BR8Sl.js";import te from"./DjtmS3jT.js";import ue from"./DGh7caCU.js";import oe from"./DanPGV3o.js";import se from"./CaSzWbCS.js";const ie={class:"tabs-container"},re={class:"search-container search-bar"},ne={key:0,class:"global-filter-label",for:"globalFilter"},ce={key:1,class:"global-filter-label advanced-search-label",for:"globalFilter"},de={key:0,class:"search-input multi-search-input-sub-filter"},ve={key:1,class:"search-input multi-search-input-sub-filter"},Ce={__name:"CourseSearchBar",props:{isSearchPage:{type:Boolean,default:!1},resetPage:{type:Function,default:null}},setup(d){const C=x(),b=j(),{programSet:B}=Q();ee(),v("updateMenubar");const F=v("deptList");v("isShowSchedule",()=>!1);const k=v("isShowAdvancedSearch",()=>!1),T=v("subFilterRef",()=>null);v("scrollTableRef",()=>null);const u=v("filters",()=>({global:{value:null,matchMode:r.CONTAINS},...Object.fromEntries(["option_code","course_name","chn_name","dept_chiabbr","eng_teach","generalCore","dept_code","time_inf","time_loc","timeListStr","comment","credit","programs"].map(t=>[t,{operator:p.OR,constraints:[]}]))})),w=v("advancedSearchDisplayValue",()=>"點擊進行進階搜尋"),N=v("advancedSearchRebuildFunction"),o=M(""),s=M({value:null,filter_field:null,select_list:null,grouped_select_list:null,label:null}),f=M({quick:{label:"快速搜尋",value:"quick",route:"/?m=quick",command:()=>c({})},dept:{label:"系所",activeLabel:"開課系所",value:"dept",route:"/?m=dept",command:()=>c({dept_chiabbr:{operator:p.OR,constraints:[{value:null,matchMode:r.CONTAINS}]}},{label:"選擇開課單位",grouped_select_list:F.value||{},filter_field:"dept_code"})},advanced:{label:"進階搜尋",value:"advanced",route:"/?m=advanced",command:()=>{k.value=!0,c({}),u.value.global.value=null,N&&N.value&&N.value()}},general:{label:"通識",value:"general",route:"/?m=general",command:()=>c({option_code:{operator:p.OR,constraints:[{value:"通",matchMode:r.EQUALS}]}},{label:"選擇通識領域",select_list:Object.entries({人文藝術:"A1UG",社會科學:"A2UG",自然科學:"A3UG",邏輯運算:"A4UG",學院共同課程:"B1UG",跨域專業探索課程:"B2UG",大學入門:"B3UG",專題探究:"C1UG",MOOCs:"C2UG"}).map(([t,e])=>({label:t,value:{value:e,matchMode:r.CONTAINS}})),filter_field:"generalCore"})},physical:{label:"體育",activeLabel:"普通體育",value:"physical",route:"/?m=physical",command:()=>c({dept_chiabbr:{operator:p.OR,constraints:[{value:"體育",matchMode:r.CONTAINS}]}})},defense:{label:"國防",activeLabel:"全民國防教育",value:"defense",route:"/?m=defense",command:()=>c({chn_name:{operator:p.OR,constraints:[{value:"全民國防",matchMode:r.CONTAINS}]}})},interschool:{label:"校際",activeLabel:"臺大系統校際課程",value:"interschool",route:"/?m=interschool",command:()=>c({dept_chiabbr:{operator:p.OR,constraints:[{value:"校際",matchMode:r.CONTAINS}]}},{label:"選擇開課學校",select_list:Object.entries({國立臺灣大學:"AA",國立臺灣科技大學:"AB"}).map(([t,e])=>({label:t,value:{value:e,matchMode:r.ENDS_WITH}})),filter_field:"dept_code"})},program:{label:"學分學程",value:"program",route:"/?m=program",command:()=>c({chn_name:{operator:p.OR,constraints:[{value:"學分學程",matchMode:r.CONTAINS}]}},{label:"選擇學分學程",select_list:[...B.value].sort().map(t=>({label:t,value:{value:t,matchMode:r.CONTAINS}})),filter_field:"programs"})},english:{label:"英文三",value:"english",route:"/?m=english",command:()=>c({course_name:{operator:p.OR,constraints:[{value:"英文（三）",matchMode:r.CONTAINS}]}})},emi:{label:"英文授課",value:"emi",route:"/?m=emi",command:()=>c({eng_teach:{operator:p.OR,constraints:[{value:"是",matchMode:r.EQUALS}]}})},"":{label:"",value:"quick",route:"/?m=quick",command:()=>c({})}});function c(t,e=null){var a,n,i;D({title:((a=f.value[o.value])==null?void 0:a.activeLabel)||((n=f.value[o.value])==null?void 0:n.label)||"",description:"更適合師大人的課程查詢系統，更快、更強、行動裝置友好。"});for(const _ in u.value)_!=="global"&&(_ in t?u.value[_]=t[_]:(i=u.value[_]).constraints&&(i.constraints=[]));e?s.value={...s.value,value:null,filter_field:e.filter_field,select_list:e.select_list||null,grouped_select_list:e.grouped_select_list||null,label:e.label}:(s.value.select_list=null,s.value.grouped_select_list=null)}function q(){k.value=!0}function G(){const t=s.value.value;if(!t||Object.keys(t).length===0){u.value[s.value.filter_field].constraints=[{value:null,matchMode:r.CONTAINS}];return}const e=s.value.grouped_select_list;u.value[s.value.filter_field].constraints=Object.entries(t).map(([a,n])=>{if(!n.checked)return{value:null,matchMode:r.CONTAINS};const i=a.split("-");return i.length===1?e[a].data:i.length===2?e[i[0]].children[i[1]].data:e[i[0]].children[i[1]].children[i[2]].data})}function L(){if(u.value.global.value){const t=v("routerLoading",()=>!1);t.value=!0,C.push(`/?s=${u.value.global.value}`)}}function z({path:t=null,m:e=null,s:a=null}){var n,i;t||(t=b.path),e||(e=o.value||void 0),a||(a=((i=(n=u.value)==null?void 0:n.global)==null?void 0:i.value)||void 0),C.push({path:t,query:{...b.query,m:e,s:a}})}function O({path:t=null,m:e=null,s:a=null}){var n,i;t||(t=b.path),e||(e=o.value||void 0),a||(a=((i=(n=u.value)==null?void 0:n.global)==null?void 0:i.value)||void 0),C.replace({path:t,query:{...b.query,m:e,s:a}})}return E(()=>{var t;o.value=b.query.m||"quick",f.value[o.value]?(t=f.value[o.value])==null||t.command():o.value="quick",b.query.s?u.value.global.value=b.query.s:u.value.global.value=null}),K(()=>b.query,t=>{var e;t.m&&(f.value[t.m]?(o.value=t.m,(e=f.value[t.m])==null||e.command()):o.value="quick"),t.s?u.value.global.value=t.s:u.value.global.value=null},{immediate:!0}),(t,e)=>(m(),g(U,null,[A("div",ie,[h(l(te),{value:l(o),"onUpdate:value":e[0]||(e[0]=a=>X(o)?o.value=a:null),scrollable:""},{default:S(()=>[h(l(le),{class:R(d.isSearchPage?"":"tab-disabled")},{default:S(()=>[(m(!0),g(U,null,H(Object.values(l(f)),a=>(m(),y(l(ae),{as:"a",key:a.value,value:a.value,class:R(d.isSearchPage&&a.label?"":"tab-disabled"),href:a.route||null,style:{"text-decoration":"none"},onClick:W(()=>{var n,i;(!d.isSearchPage||l(o)!=a.value)&&(o.value=a.value),l(f)[l(o)]&&((i=(n=l(f)[l(o)]).command)==null||i.call(n)),d.resetPage&&d.resetPage(),d.isSearchPage?z({m:l(o)}):O({path:"/",m:l(o),s:l(u).global.value||void 0})},["prevent"])},{default:S(()=>[J($(l(o)==a.value&&a.activeLabel||a.label),1)]),_:2},1032,["value","class","href","onClick"]))),128))]),_:1},8,["class"])]),_:1},8,["value"])]),A("div",re,[h(l(ue),{variant:"in",class:R(["search-input",l(s).select_list||l(s).grouped_select_list?"multi-search-input-main-filter":"single-search-input"]),onClick:e[7]||(e[7]=a=>l(k)?q():null)},{default:S(()=>[h(l(Y),null,{default:S(()=>[h(l(Z),null,{default:S(()=>e[12]||(e[12]=[A("i",{class:"pi pi-search"},null,-1)])),_:1}),d.isSearchPage&&l(o)!="advanced"?(m(),y(l(V),{key:0,id:"globalFilter",modelValue:l(u).global.value,"onUpdate:modelValue":e[1]||(e[1]=a=>l(u).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"},onBlur:e[2]||(e[2]=a=>O({s:l(u).global.value})),onKeyup:e[3]||(e[3]=I(a=>O({s:l(u).global.value}),["enter"]))},null,8,["modelValue"])):d.isSearchPage?(m(),y(l(V),{key:1,id:"globalFilter",value:"",readonly:"",autocapitalize:!1,size:"large",style:{width:"100%",cursor:"pointer"},onClick:q})):(m(),y(l(V),{key:2,id:"globalFilter",modelValue:l(u).global.value,"onUpdate:modelValue":e[4]||(e[4]=a=>l(u).global.value=a),autocapitalize:!1,size:"large",style:{width:"100%"},onBlur:e[5]||(e[5]=a=>L()),onKeyup:e[6]||(e[6]=I(a=>L(),["enter"]))},null,8,["modelValue"]))]),_:1}),l(o)!="advanced"?(m(),g("label",ne,"課程名稱/教師/開課序號")):(m(),g("label",ce,$(l(w)||"點擊進行進階搜尋"),1))]),_:1},8,["class"]),d.isSearchPage&&l(s).select_list?(m(),g("div",de,[h(l(oe),{ref_key:"subFilterRef",ref:T,id:"sub-filter",modelValue:l(s).value,"onUpdate:modelValue":e[8]||(e[8]=a=>l(s).value=a),options:l(s).select_list,optionLabel:"label",optionValue:"value",showClear:!0,showToggleAll:!1,filter:!0,placeholder:l(s).label,display:"chip",style:{width:"100%"},onChange:e[9]||(e[9]=a=>{l(u)[l(s).filter_field].constraints=a.value||[{value:null,matchMode:l(r).CONTAINS}]})},null,8,["modelValue","options","placeholder"])])):P("",!0),d.isSearchPage&&l(s).grouped_select_list?(m(),g("div",ve,[h(l(se),{ref_key:"subFilterRef",ref:T,id:"sub-filter-grouped",modelValue:l(s).value,"onUpdate:modelValue":e[10]||(e[10]=a=>l(s).value=a),options:l(s).grouped_select_list,selectionMode:"checkbox",filter:"",filterMode:"strict",showClear:!0,placeholder:l(s).label,style:{width:"100%"},onChange:e[11]||(e[11]=a=>G())},null,8,["modelValue","options","placeholder"])])):P("",!0)])],64))}};export{Ce as _};
